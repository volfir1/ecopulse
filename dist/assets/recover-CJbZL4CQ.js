import{k as U,o as I,d as C,u as E,b as M,e as $,r as l,j as e,q as F,t as D,s as O,i as N,f as d}from"./index-D-CDyacC.js";import{X as J}from"./x-Cf4ZMjTF.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],_=U("Loader",Y),X=()=>{const[u]=I(),m=C(),{setUser:y,setIsAuthenticated:b}=E(),x=M(),i=$(),[h,c]=l.useState("loading"),[R,A]=l.useState(""),[f,g]=l.useState(""),[k,v]=l.useState(null),[p,S]=l.useState(""),t=(()=>{let s=u.get("token");if(s||(s=u.get("reactivationToken")),!s&&m.search){const o=m.search.substring(1),n=new URLSearchParams(o);s=n.get("token")||n.get("reactivationToken")}if(!s){const o=window.location.href.match(/[?&](token|reactivationToken)=([^&#]+)/);o&&o[2]&&(s=decodeURIComponent(o[2]))}return console.log("Token detection process:",{"searchParams.token":u.get("token"),"searchParams.reactivationToken":u.get("reactivationToken"),"manual parse":s,"location.search":m.search,"window.location.href":window.location.href}),s})(),w=l.useRef(!1);l.useEffect(()=>{if(console.log("AccountRecovery component mounted with URL:",window.location.href),console.log("Detected token:",t?`${t.substring(0,8)}...`:"none"),w.current)return;t?(async()=>{var o,n;if(!t){c("error"),g("No recovery token found in URL. Please use the link sent to your email."),v({url:window.location.href,search:m.search,params:Object.fromEntries([...u])});return}w.current=!0,console.log(`Attempting account reactivation with token: ${t.substring(0,8)}...${t.substring(t.length-8)}`);try{const a=d.reactivateAccount||d.recoverAccount;console.log(`Using recovery method: ${d.reactivateAccount?"reactivateAccount":"recoverAccount"}`);const r=await a(t);console.log("Recovery result:",r),r.success?(r.user&&(console.log("Received user data:",r.user),localStorage.setItem("user",JSON.stringify(r.user)),y(r.user),b(!0),r.user.accessToken&&localStorage.setItem("authToken",r.user.accessToken)),c("success"),A(r.message||"Your account has been successfully reactivated!"),i.success("Account reactivated successfully"),setTimeout(()=>{var j;((j=r.user)==null?void 0:j.role)==="admin"?x("/admin/dashboard"):x("/dashboard")},3e3)):(c("error"),g(r.message||"Failed to reactivate account."),v(r.debug||null),i.error(r.message||"Failed to reactivate account"))}catch(a){console.error("Account reactivation error:",a),a.response&&(console.error("Response data:",a.response.data),console.error("Response status:",a.response.status),v({message:a.message,status:(o=a.response)==null?void 0:o.status,responseData:(n=a.response)==null?void 0:n.data})),c("error"),g(a.message||"An error occurred during account reactivation."),i.error(a.message||"An error occurred during account reactivation")}})():(c("error"),g("No recovery token found in URL. Please use the link sent to your email."))},[t,x,y,b,i,m,u]);const T=()=>{window.location.reload()},q=()=>{if(!p){i.error("Please enter a token");return}const s=new URL(window.location);s.searchParams.set("token",p),window.history.pushState({},"",s),window.location.reload()},L=async()=>{const s=prompt("Please enter your email address to request a new reactivation link:");if(s)try{c("loading");const o=d.requestReactivation||d.requestAccountRecovery;console.log(`Using request method: ${d.requestReactivation?"requestReactivation":"requestAccountRecovery"}`);const n=await o(s);n.success?(i.success("A new reactivation link has been sent to your email."),c("error"),g("A new reactivation link has been sent to your email. Please check your inbox and spam folders.")):(i.error(n.message||"Failed to send reactivation email"),c("error"))}catch(o){console.error("Error requesting new token:",o),i.error(o.message||"Failed to send reactivation email"),c("error")}},P=!t&&h==="error";return e.jsx("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center p-6",children:e.jsxs(F.Base,{className:"max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("img",{src:"/logo.png",alt:"EcoPulse Logo",className:"w-16 h-16 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",style:{color:D.main},children:"Account Reactivation"})]}),h==="loading"&&e.jsxs("div",{className:"flex flex-col items-center py-8",children:[e.jsx("div",{className:"mb-4",children:e.jsx(_,{className:"w-12 h-12 animate-spin text-green-600"})}),e.jsx("p",{className:"text-gray-600 text-center",children:"Processing your account reactivation request..."}),t&&e.jsxs("p",{className:"text-xs text-gray-400 mt-4",children:["Token: ",t.substring(0,8),"...",t.substring(t.length-8)]})]}),h==="success"&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"mb-6 flex justify-center",children:e.jsx("div",{className:"rounded-full bg-green-100 p-4",children:e.jsx(O,{className:"w-12 h-12 text-green-600"})})}),e.jsx("h2",{className:"text-lg font-medium text-gray-800 mb-2",children:"Reactivation Successful!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:R}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"You will be redirected to your dashboard in a few seconds..."}),e.jsx(N,{to:"/dashboard",className:"block w-full py-2 px-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-center",children:"Go to Dashboard Now"})]}),h==="error"&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"mb-6 flex justify-center",children:e.jsx("div",{className:"rounded-full bg-red-100 p-4",children:e.jsx(J,{className:"w-12 h-12 text-red-600"})})}),e.jsx("h2",{className:"text-lg font-medium text-gray-800 mb-2",children:"Reactivation Failed"}),e.jsx("p",{className:"text-red-500 mb-6",children:f}),P&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-100 rounded-lg space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-700",children:"If you have a reactivation token, you can enter it manually below:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Enter reactivation token",className:"flex-1 px-3 py-2 border rounded-lg text-sm",value:p,onChange:s=>S(s.target.value)}),e.jsx("button",{onClick:q,className:"px-4 py-2 bg-blue-600 text-white rounded-lg text-sm",children:"Submit"})]})]}),t&&e.jsx("div",{className:"text-xs text-gray-500 mb-4 p-2 bg-gray-100 rounded-lg",children:e.jsxs("p",{children:["Reactivation Token: ",t.substring(0,8),"...",t.substring(t.length-8)]})}),k&&e.jsx("div",{className:"text-xs text-left mb-4 p-2 bg-gray-100 rounded-lg overflow-auto max-h-32",children:e.jsx("pre",{children:JSON.stringify(k,null,2)})}),e.jsxs("div",{className:"space-y-3",children:[t&&e.jsx("button",{onClick:T,className:"block w-full py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-center",children:"Retry Reactivation"}),e.jsx("button",{onClick:L,className:"block w-full py-2 px-4 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors text-center",children:"Request New Reactivation Link"}),e.jsx(N,{to:"/login",className:"block w-full py-2 px-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-center",children:"Return to Login"}),e.jsx("button",{onClick:()=>{const s="support@ecopulse.com",o="Account Reactivation Issue",n=`I'm having an issue reactivating my account.

Token: ${t||"No token provided"}
Error: ${f}`;window.location.href=`mailto:${s}?subject=${encodeURIComponent(o)}&body=${encodeURIComponent(n)}`},className:"block w-full py-2 px-4 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-center",children:"Contact Support"})]})]})]})})};export{X as default};
