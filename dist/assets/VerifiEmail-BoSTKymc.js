import{d as T,b as R,o as W,e as k,u as B,r as n,j as e,B as L,T as m,a as f}from"./index-D-CDyacC.js";import{T as A}from"./TextField-GEjcJewa.js";import"./Select-BXcoeulH.js";const q=()=>{const y=T(),h=R(),[v]=W(),t=k(),{verifyEmail:p,resendVerificationCode:b,isLoading:D}=B(),[a,V]=n.useState(""),[j,x]=n.useState(!1),[c,E]=n.useState(60),[l,g]=n.useState(0),d=y.state||{},C=v.get("userId"),S=v.get("email"),s=d.userId||C||"",u=d.email||S||"",w=d.provider||"email",I=async i=>{if(i&&i.preventDefault(),!a){t.error("Please enter a verification code");return}x(!0);try{console.log("Verification attempt:",{userId:s,email:u,verificationCode:a,attempts:l+1}),g(o=>o+1);const r=await p(s,a);if(r!=null&&r.success)t.success("Email verified successfully!"),setTimeout(()=>{h("/onboarding",{replace:!0,state:{verified:!0,email:u,userId:s,message:"Email verified successfully! Complete your profile to get started."}})},1500);else throw new Error("Verification failed")}catch(r){console.error("Verification error:",r);const o=r.message||"Verification failed";o.includes("Invalid verification code")?t.error("Invalid verification code. Please check and try again."):t.error(o)}finally{x(!1)}},P=async()=>{try{await b(s),E(60),g(0),t.success("New verification code sent!")}catch(i){t.error(i.message||"Failed to resend code")}};return e.jsxs(L,{sx:{maxWidth:400,mx:"auto",mt:8,p:3},children:[e.jsx(m,{variant:"h4",gutterBottom:!0,children:"Verify Your Email"}),e.jsx(m,{variant:"body1",sx:{mb:3},children:w==="google"?"Please enter the verification code sent to your Google email":"Please enter the verification code sent to your email"}),e.jsxs(m,{variant:"body2",color:"textSecondary",sx:{mb:2},children:["Email: ",u||"your email"]}),!1,e.jsxs("form",{onSubmit:I,noValidate:!0,children:[e.jsx(A,{fullWidth:!0,label:"Verification Code",value:a,onChange:i=>V(i.target.value),margin:"normal",required:!0,error:l>1,helperText:l>1?"Multiple incorrect attempts":""}),e.jsx(f,{fullWidth:!0,variant:"contained",type:"submit",sx:{mt:3},children:j?"Verifying...":"Verify Email"}),e.jsx(f,{fullWidth:!0,variant:"text",onClick:P,disabled:c>0,sx:{mt:2},children:c>0?`Resend code in ${c}s`:"Resend verification code"}),e.jsx(f,{fullWidth:!0,variant:"text",onClick:()=>h("/login"),sx:{mt:1},children:"Return to Login"})]})]})};export{q as default};
