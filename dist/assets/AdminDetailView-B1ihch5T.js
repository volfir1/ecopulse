import{k as ee,b as se,r as h,V as re,e as ae,l as ie,a7 as ne,j as e,q as v,B as t,T as r,$ as S,I as oe,a1 as $,D as b,a8 as le,U as ce,h as de,v as xe,g as J,a4 as g}from"./index-BN0NLy4X.js";import{t as k}from"./ticketService-BUEzRzQk.js";import{C as K}from"./Chip-BQdj-Ugh.js";import{F as Q,S as X}from"./Select-BvIDhjGm.js";import"./axios-CmsuhreG.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Z=ee("ArrowLeft",he);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],me=ee("Tag",ue),pe=o=>{const c=se(),{user:s,isAuthenticated:E}=h.useContext(re),l=ae(),a=ie(),[f,u]=h.useState(null),[L,y]=h.useState(!0),[j,F]=h.useState(""),[D,w]=h.useState(!1),[A,m]=h.useState(""),[N,C]=h.useState([]),[p,T]=h.useState("");return h.useEffect(()=>{E&&(s==null?void 0:s.role)!=="admin"&&(l.error("You do not have access to this page"),c("/"))},[E,s,c,l]),h.useEffect(()=>{const d=async()=>{y(!0),typeof a.showLoader=="function"&&a.showLoader();try{const i=await k.getTicket(o);u(i.data.data||i.data),m(i.data.status||"open")}catch(i){console.error("Error fetching ticket:",i),l.error(i.message||"Failed to fetch ticket"),c("/admin/tickets")}finally{y(!1),typeof a.hideLoader=="function"&&a.hideLoader()}},x=async()=>{try{const i=await k.getAdmins();C(i.data)}catch(i){console.error("Error fetching admins:",i)}};o&&(d(),x())},[o,c,l,a]),{ticket:f,loading:L,replyContent:j,setReplyContent:F,submitting:D,newStatus:A,admins:N,selectedAdmin:p,setSelectedAdmin:T,handleReply:async d=>{if(d.preventDefault(),!j.trim()){l.warning("Please enter a reply");return}w(!0),typeof a.showLoader=="function"&&a.showLoader();try{const x=await k.replyToTicket(o,j);u(x.data),F(""),l.success("Reply sent successfully")}catch(x){console.error("Error replying to ticket:",x),l.error(x.message||"Failed to send reply")}finally{w(!1),typeof a.hideLoader=="function"&&a.hideLoader()}},handleStatusChange:async d=>{const x=d.target.value;m(x),typeof a.showLoader=="function"&&a.showLoader();try{const i=await k.updateTicketStatus(o,x);u(i.data),l.success(`Ticket status updated to ${x}`)}catch(i){console.error("Error updating ticket status:",i),l.error(i.message||"Failed to update ticket status"),m(f.status)}finally{typeof a.hideLoader=="function"&&a.hideLoader()}},handleAssignTicket:async()=>{if(!p){l.warning("Please select an admin to assign");return}typeof a.showLoader=="function"&&a.showLoader();try{const d=await k.assignTicket(o,p);u(d.data),l.success("Ticket assigned successfully")}catch(d){console.error("Error assigning ticket:",d),l.error(d.message||"Failed to assign ticket")}finally{typeof a.hideLoader=="function"&&a.hideLoader()}}}},I=o=>{if(!o)return"N/A";try{const c=new Date(o);return isNaN(c.getTime())?(console.warn("Invalid date:",o),"Invalid Date"):new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(c)}catch(c){return console.error("Date formatting error:",c),"Invalid Date"}},ge=o=>{switch(o){case"open":return{bg:"#EEF7FF",color:"#1A73E8"};case"in-progress":return{bg:"#FFF7E0",color:"#F29D41"};case"resolved":return{bg:"#E7F7ED",color:"#34A853"};case"closed":return{bg:"#F2F2F2",color:"#5F6368"};default:return{bg:"#F2F2F2",color:"#5F6368"}}},fe=o=>{switch(o){case"low":return{bg:"#E7F7ED",color:"#34A853"};case"medium":return{bg:"#FFF7E0",color:"#F29D41"};case"high":return{bg:"#FFEBEE",color:"#E53935"};case"urgent":return{bg:"#7F1D1D",color:"#FFFFFF"};default:return{bg:"#F2F2F2",color:"#5F6368"}}},Fe=()=>{var A,m,N,C,p,T,z,B,W,d,x,i,P,R,_,U,q,H,M,V,O,Y,G;const{id:o}=ne(),c=se(),{ticket:s,loading:E,replyContent:l,setReplyContent:a,submitting:f,newStatus:u,admins:L,selectedAdmin:y,setSelectedAdmin:j,handleReply:F,handleStatusChange:D,handleAssignTicket:w}=pe(o);return s?e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(oe,{onClick:()=>c("/admin/tickets"),sx:{mr:2},children:e.jsx(Z,{size:20})}),e.jsxs("div",{children:[e.jsxs(r,{variant:"h5",fontWeight:"bold",color:"text.primary",children:["Ticket #",s.ticketNumber]}),e.jsx(r,{variant:"body1",color:"text.secondary",children:s.subject})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(v.Base,{children:[e.jsxs(t,{sx:{p:3},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx($,{src:(A=s.user)==null?void 0:A.profilePicture,sx:{width:40,height:40,mr:2},children:((N=(m=s.user)==null?void 0:m.firstName)==null?void 0:N.charAt(0))||((p=(C=s.user)==null?void 0:C.email)==null?void 0:p.charAt(0))}),e.jsxs(t,{children:[e.jsx(r,{variant:"subtitle1",fontWeight:"medium",children:(T=s.user)!=null&&T.firstName&&((z=s.user)!=null&&z.lastName)?`${s.user.firstName} ${s.user.lastName}`:(B=s.user)==null?void 0:B.email}),e.jsx(r,{variant:"caption",color:"text.secondary",children:I(s.createdAt)})]})]}),e.jsx(r,{variant:"body1",sx:{mt:2,whiteSpace:"pre-wrap"},children:((d=(W=s.messages)==null?void 0:W[0])==null?void 0:d.content)||"No description provided"})]}),e.jsx(b,{}),e.jsx(t,{sx:{maxHeight:"500px",overflow:"auto",p:3},children:s.messages&&s.messages.length>1?s.messages.slice(1).map((n,te)=>e.jsxs(t,{sx:{mb:3,p:2,borderRadius:2,backgroundColor:n.isAdmin?"#F0FDF4":"#F8F9FA"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx($,{sx:{width:32,height:32,mr:1,bgcolor:n.isAdmin?"#16A34A":"#6B7280"},children:n.isAdmin?"A":"U"}),e.jsxs(t,{children:[e.jsx(r,{variant:"subtitle2",fontWeight:"medium",children:n.isAdmin?"Support Agent":"Customer"}),e.jsx(r,{variant:"caption",color:"text.secondary",children:I(n.createdAt)})]})]}),e.jsx(r,{variant:"body2",sx:{mt:1,whiteSpace:"pre-wrap"},children:n.content})]},te)):e.jsx(r,{variant:"body2",color:"text.secondary",align:"center",children:"No replies yet"})}),e.jsx(b,{}),e.jsx(t,{sx:{p:3},children:e.jsxs("form",{onSubmit:F,children:[e.jsx(le,{name:"replyContent",value:l,onChange:n=>a(n.target.value),placeholder:"Type your reply here...",rows:4,required:!0}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(S,{type:"submit",loading:f,disabled:f||!l.trim(),children:"Send Reply"})})]})})]})}),e.jsxs("div",{children:[e.jsx(v.Base,{className:"mb-6",children:e.jsxs(t,{sx:{p:3},children:[e.jsx(r,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Ticket Details"}),e.jsx(b,{sx:{my:2}}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",width:100},children:[e.jsx(ce,{size:16,className:"mr-2"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Customer:"})]}),e.jsx(r,{variant:"body2",fontWeight:"medium",children:(x=s.user)!=null&&x.firstName&&((i=s.user)!=null&&i.lastName)?`${s.user.firstName} ${s.user.lastName}`:(P=s.user)==null?void 0:P.email})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",width:100},children:[e.jsx(me,{size:16,className:"mr-2"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Category:"})]}),e.jsx(r,{variant:"body2",fontWeight:"medium",sx:{textTransform:"capitalize"},children:s.category})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",width:100},children:[e.jsx(de,{size:16,className:"mr-2"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Priority:"})]}),e.jsx(K,{label:s.priority,size:"small",sx:{...fe(s.priority),textTransform:"capitalize",fontWeight:"medium",fontSize:"0.75rem"}})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",width:100},children:[e.jsx(xe,{size:16,className:"mr-2"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Status:"})]}),e.jsx(K,{label:(s.status||"unknown").replace("-"," "),size:"small",sx:{...ge(s.status||"unknown"),textTransform:"capitalize",fontWeight:"medium",fontSize:"0.75rem"}})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",width:100},children:[e.jsx(J,{size:16,className:"mr-2"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Created:"})]}),e.jsx(r,{variant:"body2",children:I(s.createdAt)})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",width:100},children:[e.jsx(J,{size:16,className:"mr-2"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Updated:"})]}),e.jsx(r,{variant:"body2",children:I(s.updatedAt)})]})]})]})}),e.jsx(v.Base,{className:"mb-6",children:e.jsxs(t,{sx:{p:3},children:[e.jsx(r,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Ticket Actions"}),e.jsx(b,{sx:{my:2}}),e.jsxs(t,{sx:{mb:3},children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Update Status"}),e.jsx(Q,{fullWidth:!0,size:"small",children:e.jsxs(X,{value:u,onChange:D,displayEmpty:!0,children:[e.jsx(g,{value:"open",children:"Open"}),e.jsx(g,{value:"in-progress",children:"In Progress"}),e.jsx(g,{value:"resolved",children:"Resolved"}),e.jsx(g,{value:"closed",children:"Closed"})]})})]}),e.jsxs(t,{children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Assign Ticket"}),e.jsxs(t,{sx:{display:"flex",gap:1},children:[e.jsx(Q,{fullWidth:!0,size:"small",children:e.jsxs(X,{value:y,onChange:n=>j(n.target.value),displayEmpty:!0,children:[e.jsx(g,{value:"",disabled:!0,children:s.assignedTo?`Currently: ${s.assignedTo.firstName} ${s.assignedTo.lastName}`:"Select Admin"}),L.map(n=>e.jsxs(g,{value:n._id,children:[n.firstName," ",n.lastName]},n._id))]})}),e.jsx(S,{onClick:w,disabled:!y,variant:"outlined",children:"Assign"})]})]})]})}),e.jsx(v.Base,{children:e.jsxs(t,{sx:{p:3},children:[e.jsx(r,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Customer Information"}),e.jsx(b,{sx:{my:2}}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx($,{src:(R=s.user)==null?void 0:R.profilePicture,sx:{width:64,height:64,mr:2},children:((U=(_=s.user)==null?void 0:_.firstName)==null?void 0:U.charAt(0))||((H=(q=s.user)==null?void 0:q.email)==null?void 0:H.charAt(0))}),e.jsxs(t,{children:[e.jsx(r,{variant:"subtitle1",fontWeight:"medium",children:(M=s.user)!=null&&M.firstName&&((V=s.user)!=null&&V.lastName)?`${s.user.firstName} ${s.user.lastName}`:(O=s.user)==null?void 0:O.email}),e.jsx(r,{variant:"body2",color:"text.secondary",children:(Y=s.user)==null?void 0:Y.email})]})]}),((G=s.user)==null?void 0:G.phone)&&e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",sx:{width:100},children:"Phone:"}),e.jsx(r,{variant:"body2",children:s.user.phone})]}),e.jsx(t,{sx:{mt:2},children:e.jsx(S,{variant:"outlined",fullWidth:!0,onClick:()=>{var n;return c(`/admin/customers/${(n=s.user)==null?void 0:n._id}`)},children:"View Customer Profile"})})]})})]})]})]}):e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsx(v.Error,{children:e.jsxs(t,{sx:{p:4,textAlign:"center"},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"Ticket Not Found"}),e.jsx(r,{variant:"body1",paragraph:!0,children:"The ticket you're looking for doesn't exist or you don't have permission to view it."}),e.jsx(S,{onClick:()=>c("/admin/tickets"),startIcon:e.jsx(Z,{size:18}),children:"Back to Tickets"})]})})})};export{Fe as default};
