import{e as je,r as a,a1 as B,a0 as Ce,j as e,R as De,ak as Ge,a2 as K,o as X,T as U,aA as te,aB as ne,J as se,aC as oe,B as le,a4 as $,aD as ie,a3 as V}from"./index-CeiZKB8G.js";import{S as de}from"./SingleYearPicker--w-JP6tS.js";import{Y as Ee}from"./YearPicker-CopMytEh.js";import{D as we}from"./DataTable-wS0beIS8.js";import{u as ke}from"./useDataTable-oECYLwsK.js";import Ne from"./html2canvas.esm-CBrSDip1.js";import{T as ce}from"./thermometer-BiCz2k3Y.js";import{R as Se,a as Ye,X as Re,Y as Pe,T as Fe}from"./generateCategoricalChart-D0QOHPu-.js";import{L as We,a as Ae}from"./LineChart-BbR2cBpr.js";import{X as ue}from"./x-CZmEDHb-.js";import"./DatePicker-Ds6sJbAa.js";import"./index-D_GLsIW_.js";import"./useThemeProps-B7RzBULZ.js";import"./index-BGHELInD.js";import"./TextField-CJViWXc3.js";import"./Select-CMa9xVQT.js";import"./Chip-D2qSxnvf.js";import"./AdapterDayjs-J5u3snYC.js";import"./refresh-ccw-DYG20dKq.js";import"./download-DBO_fhAY.js";import"./TablePagination-CbCjEsJh.js";import"./KeyboardArrowRight-Bas1HYWb.js";import"./TableRow-DpNBZInR.js";import"./SwitchBase-BXTMIM8-.js";import"./chevron-up-BJCzFM4M.js";const Me=()=>{const i=je(),n=(i==null?void 0:i.enqueueSnackbar)||(r=>console.log("Snackbar message:",r)),[s,m]=a.useState([]),[h,x]=a.useState(null),[P,d]=a.useState(!0),[j,L]=a.useState(new Date().getFullYear()),[C,I]=a.useState(new Date().getFullYear()+5),[O,E]=a.useState(0),D=a.useRef(null),N=r=>r.replace(/NaN/g,"null"),g=a.useCallback(async(r,o)=>{d(!0);try{const l=await B.get(`/api/predictions/geothermal/?start_year=${r}&end_year=${o}`),p=typeof l.data=="string"?l.data:JSON.stringify(l.data),b=N(p),k=JSON.parse(b);if(k.status==="success"&&Array.isArray(k.predictions)){const z=k.predictions.map(u=>({date:u.Year,value:parseFloat(u["Predicted Production"]),nonRenewableEnergy:u.isPredicted?null:u["Non-Renewable Energy (GWh)"]?parseFloat(u["Non-Renewable Energy (GWh)"]):null,population:u.isPredicted?null:u["Population (in millions)"]?parseFloat(u["Population (in millions)"]):null,gdp:u.isPredicted||u["Gross Domestic Product"]===null?null:parseFloat(u["Gross Domestic Product"]),isPredicted:u.isPredicted!==void 0?u.isPredicted:!1,isDeleted:u.isDeleted!==void 0?u.isDeleted:!1}));console.log("Raw fetched data:",k.predictions),console.log("Formatted data:",z),m(z)}else throw new Error("Invalid data format in API response")}catch(l){console.error("Error fetching data:",l),n("Failed to fetch data. Please try again.",{variant:"error"})}finally{d(!1)}},[n]);a.useEffect(()=>{g(j,C)},[j,C,O]);const F=a.useCallback(r=>{L(r)},[]),y=a.useCallback(r=>{I(r)},[]),W=a.useCallback(()=>{E(r=>r+1)},[]),S=a.useCallback(async()=>{try{try{n("Preparing your download...",{variant:"info"})}catch{console.log("Preparing download...")}const r=new Ce({orientation:"portrait",unit:"mm",format:"a4"});if(r.setFontSize(16),r.text("Geothermal Power Generation Summary",15,15),r.setFontSize(11),r.text(`Year Range: ${j} - ${C}`,15,25),r.text(`Current Projection: ${h?h.toFixed(2):"N/A"} GWh`,15,30),r.text(`Generated on: ${new Date().toLocaleDateString()}`,15,35),D.current)try{const l=D.current,b=(await Ne(l,{scale:2,useCORS:!0,logging:!1})).toDataURL("image/png");r.addImage(b,"PNG",15,45,180,80),r.setFontSize(12),r.text("Geothermal Generation Chart",15,45)}catch(l){console.error("Error capturing chart:",l)}const o=D.current?140:45;r.setFontSize(12),r.text("Geothermal Generation Data Table",15,o-5),r.autoTable({head:[["Year","Predicted Production (GWh)"]],body:s.map(l=>[l.date,l.value.toFixed(2)]),startY:o,margin:{left:15,right:15},headStyles:{fillColor:[255,107,107]},styles:{fontSize:10,cellPadding:3}}),r.save("Geothermal_Power_Generation_Summary.pdf");try{n("Summary downloaded successfully!",{variant:"success"})}catch{console.log("Summary downloaded successfully!")}}catch(r){console.error("Download error:",r);try{n("Failed to download summary. Please try again.",{variant:"error"})}catch(o){console.error("Error showing notification:",o),alert("Failed to download summary. Please try again.")}}},[s,j,C,h,n,D]),A=Array.from({length:7},(r,o)=>({day:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"][o],surface:150+Math.sin(o*.5)*10+Math.random()*5,deep:280+Math.sin(o*.3)*5+Math.random()*3})),Y=Array.from({length:6},(r,o)=>({well:`Well ${o+1}`,pressure:85+Math.sin(o*.7)*10+Math.random()*5,output:2600+Math.sin(o*.6)*300+Math.random()*200})),M=a.useCallback(async(r,o)=>{d(!0);try{const l={Year:r,"Geothermal (GWh)":o};await B.post("/api/predictions/geothermal/",l);try{n("Geothermal generation data added successfully",{variant:"success"})}catch{console.log("Geothermal generation data added successfully")}E(p=>p+1)}catch(l){console.error("Error adding data:",l);try{n("Failed to add geothermal generation data",{variant:"error"})}catch(p){console.error("Error showing notification:",p)}}finally{d(!1)}},[n]),R=a.useCallback(async(r,o)=>{d(!0);try{await B.put(`/api/update/${r}/`,o);try{n("Geothermal generation data updated successfully",{variant:"success"})}catch{console.log("Geothermal generation data updated successfully")}E(l=>l+1)}catch(l){console.error("Error updating data:",l);try{n("Failed to update geothermal generation data",{variant:"error"})}catch(p){console.error("Error showing notification:",p)}}finally{d(!1)}},[n]),T=a.useCallback(async r=>{d(!0);try{await B.put(`/api/update/${r}/`,{isDeleted:!0});try{n("Geothermal generation data deleted successfully",{variant:"success"})}catch{console.log("Geothermal generation data deleted successfully")}E(o=>o+1)}catch(o){console.error("Error deleting data:",o);try{n("Failed to delete geothermal generation data",{variant:"error"})}catch(l){console.error("Error showing notification:",l)}}finally{d(!1)}},[n]),w=a.useCallback(async r=>{d(!0);try{await B.put(`/api/recover/${r}/`,{isDeleted:!1});try{n("Geothermal generation data recovered successfully",{variant:"success"})}catch{console.log("Geothermal generation data deleted successfully")}E(o=>o+1)}catch(o){console.error("Error recovering data:",o);try{n("Failed to recover geothermal generation data",{variant:"error"})}catch(l){console.error("Error showing notification:",l)}}finally{d(!1)}},[n]);return{generationData:s,currentProjection:h,loading:P,selectedStartYear:j,selectedEndYear:C,handleStartYearChange:F,handleEndYearChange:y,handleRefresh:W,handleDownload:S,addRecord:M,updateRecord:R,deleteRecord:T,recoverRecord:w,temperatureData:A,wellPerformance:Y,chartRef:D}},Te=(i,n,s,m)=>[{id:"year",label:"Year",align:"left",sortable:!0},{id:"generation",label:"Generation (GWh)",align:"right",sortable:!0,format:h=>h?h.toFixed(2):"0.00"},{id:"dateAdded",label:"Date Added",align:"center",sortable:!0,format:h=>h?new Date(h).toLocaleDateString():"-"},{id:"actions",label:"Actions",align:"center",sortable:!1,format:(h,x)=>x.isPredicted===!1&&!x.isDeleted?e.jsx(he,{row:x,onEdit:i,onDelete:n}):x.isPredicted===!1&&x.isDeleted===!0?e.jsx(he,{row:x,onRecover:s}):null}],he=De.memo(({row:i,onEdit:n,onDelete:s,onRecover:m})=>{const h=d=>{d.stopPropagation(),n(i)},x=d=>{d.stopPropagation(),s(i.year)},P=d=>{d.stopPropagation(),m(i.year)};return e.jsxs("div",{className:"flex justify-center gap-2",children:[n&&e.jsx("button",{onClick:h,className:"p-1 text-blue-600 hover:text-blue-800 hover:bg-blue-100 rounded-full transition-colors",title:"Edit",children:e.jsx(K,{name:"edit",size:18})}),s&&e.jsx("button",{onClick:x,className:"p-1 text-red-600 hover:text-red-800 hover:bg-red-100 rounded-full transition-colors",title:"Delete",children:e.jsx(K,{name:"trash",size:18})}),m&&e.jsx("button",{onClick:P,className:"p-1 text-green-600 hover:text-green-800 hover:bg-green-100 rounded-full transition-colors",title:"Recover",children:e.jsx(K,{name:"refresh",size:18})})]})}),ze=i=>!i||i.length===0?[]:[...i].sort((n,s)=>n.year-s.year).map(n=>({year:n.year.toString(),value:n.generation})),Be=()=>{const{elements:i,text:n}=Ge.palette,s="#FF6B6B";return{bar:{dataKey:"value",fill:s,radius:[4,4,0,0],barSize:30,name:"Generation (GWh)"},tooltip:{formatter:m=>[`${m.toFixed(2)} GWh`,"Generation"],labelFormatter:m=>`Year: ${m}`},xAxis:{dataKey:"year",axisLine:{stroke:"#E0E0E0"},tickLine:!1},yAxis:{axisLine:{stroke:"#E0E0E0"},tickLine:!1,label:""},line:{stroke:s,strokeWidth:2,dot:{r:4,fill:s,stroke:"#fff",strokeWidth:2},activeDot:{r:6,fill:s,stroke:"#fff",strokeWidth:2}}}},$e=(i,n)=>{const s={};return i?(i<1900||i>2100)&&(s.year="Year must be between 1900 and 2100"):s.year="Year is required",n?(isNaN(n)||parseFloat(n)<=0)&&(s.generation="Generation must be a positive number"):s.generation="Generation value is required",{isValid:Object.keys(s).length===0,errors:s}},Le=()=>{const i=new Date().getFullYear();return Array.from({length:8},(n,s)=>({id:s+1,year:i-4+s,generation:900+Math.random()*300+s*60,dateAdded:new Date(Date.now()-s*864e5).toISOString()}))},Ie=(i,n)=>n.map(s=>s.year===i?{...s,isDeleted:!1}:s),ga=()=>{const{generationData:i,currentProjection:n,loading:s,selectedStartYear:m,selectedEndYear:h,handleStartYearChange:x,handleEndYearChange:P,handleRefresh:d,handleDownload:j,addRecord:L,updateRecord:C,deleteRecord:I,recoverRecord:O,chartRef:E}=Me(),[D,N]=a.useState(!1),[g,F]=a.useState(new Date().getFullYear()),[y,W]=a.useState(""),[S,A]=a.useState(""),[Y,M]=a.useState(""),[R,T]=a.useState(""),[w,r]=a.useState(!1),[o,l]=a.useState(null);a.useCallback(()=>{r(!1),F(new Date().getFullYear()),W(""),A(""),M(""),T(""),N(!0)},[]);const p=a.useCallback(t=>{var c,_,ae,re;r(!0),l(t.id),F(t.year||new Date().getFullYear()),W(((c=t.generation)==null?void 0:c.toString())||""),A(((_=t.nonRenewableEnergy)==null?void 0:_.toString())||""),M(((ae=t.population)==null?void 0:ae.toString())||""),T(((re=t.gdp)==null?void 0:re.toString())||""),N(!0),console.log("Editing row:",t)},[]),b=a.useCallback(()=>{N(!1)},[]),k=a.useCallback(t=>{F(t)},[]),z=a.useCallback(t=>{W(t.target.value)},[]),u=a.useCallback(t=>{A(t.target.value)},[]),me=a.useCallback(t=>{M(t.target.value)},[]),ge=a.useCallback(t=>{T(t.target.value)},[]),H=a.useCallback(async t=>{if(window.confirm("Are you sure you want to delete this record?"))try{await I(t)}catch(c){console.error("Error deleting data:",c)}},[I]),Q=a.useCallback(async t=>{try{await O(t),setGenerationData(c=>Ie(t,c))}catch(c){console.error("Error recovering data:",c)}},[O]),Z=a.useCallback(async()=>{if(!(!g||!y||!S||!Y||!R))try{N(!1);const t={Year:g,"Geothermal (GWh)":parseFloat(y),"Non-Renewable Energy (GWh)":parseFloat(S),"Population (in millions)":parseFloat(Y),"Gross Domestic Product":parseFloat(R)};w?await C(g,t):await L(g,t["Geothermal (GWh)"])}catch(t){console.error("Error saving data:",t)}},[g,y,S,Y,R,w,C,L]),pe=a.useCallback(()=>{j()},[j]),q=a.useMemo(()=>{if(i.length>0){const t=i.map((c,_)=>({id:_+1,year:c.date,generation:c.value,nonRenewableEnergy:c.nonRenewableEnergy,population:c.population,gdp:c.gdp,dateAdded:new Date().toISOString(),isPredicted:c.isPredicted!==void 0?c.isPredicted:!1,isDeleted:c.isDeleted!==void 0?c.isDeleted:!1}));return console.log("Effective data:",t),t}return Le().map(t=>({...t,isPredicted:!0}))},[i]),v=a.useMemo(()=>({startYear:m,endYear:h}),[m,h]),J=a.useMemo(()=>q.filter(t=>t.year>=v.startYear&&t.year<=v.endYear),[q,v]),fe=a.useMemo(()=>ze(J),[J]),ee=a.useMemo(()=>Te(p,H,Q),[p,H,Q,q]),{data:xe,loading:ye,handleExport:be,handleRefresh:ve}=ke({data:J,columns:ee,onExport:pe,onRefresh:d}),G=a.useMemo(()=>{const t=Be();return t.line={stroke:"#FF6B6B",strokeWidth:2,dot:{r:5,fill:"#FF6B6B",stroke:"#fff",strokeWidth:2},activeDot:{r:7,fill:"#FF6B6B",stroke:"#fff",strokeWidth:2}},t.yAxis={...t.yAxis,label:{value:"Generation (GWh)",angle:-90,position:"insideLeft",style:{textAnchor:"middle"},offset:-5}},t},[]),f=a.useMemo(()=>g&&y?$e(g,y):{isValid:!1,errors:{}},[g,y]);return s&&i.length===0?e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100",children:e.jsx(ce,{className:"text-red-500",size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Geothermal Generation Data"}),e.jsx("p",{className:"text-gray-500",children:"Loading geothermal generation data..."})]})]})}),e.jsx(X.Base,{className:"mb-6 p-4 flex justify-center items-center h-96",children:e.jsxs("div",{className:"animate-pulse flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-200 rounded-full mb-4"}),e.jsx("div",{className:"h-4 w-36 bg-red-200 rounded mb-2"}),e.jsx("div",{className:"h-3 w-24 bg-red-200 rounded"})]})})]}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-100",children:e.jsx(ce,{className:"text-red-500",size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Geothermal Generation Data"}),e.jsx("p",{className:"text-gray-500",children:"Manage historical and projected geothermal generation data"})]})]})}),e.jsx(X.Base,{className:"mb-6 p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(U,{variant:"h6",className:"text-gray-700",children:"Filter Data By Year Range"}),e.jsx("div",{className:"min-w-64",children:e.jsx(Ee,{initialStartYear:v.startYear,initialEndYear:v.endYear,onStartYearChange:x,onEndYearChange:P})})]})}),e.jsxs(X.Base,{className:"mb-6 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Generation Overview"}),n&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-gray-500",children:"Latest Projection:"}),e.jsxs("span",{className:"ml-2 text-xl font-semibold text-red-600",children:[n.toFixed(2)," GWh"]})]})]}),e.jsx("div",{className:"p-6 h-96",ref:E,children:e.jsx(Se,{width:"100%",height:"100%",children:e.jsxs(We,{data:fe,margin:{top:15,right:30,left:20,bottom:5},children:[e.jsx(Ye,{strokeDasharray:"3 3"}),e.jsx(Re,{...G.xAxis}),e.jsx(Pe,{...G.yAxis}),e.jsx(Fe,{formatter:G.tooltip.formatter,labelFormatter:G.tooltip.labelFormatter}),e.jsx(Ae,{type:"monotone",dataKey:"value",stroke:G.line.stroke,strokeWidth:G.line.strokeWidth,dot:G.line.dot,activeDot:G.line.activeDot,name:"Generation (GWh)"})]})})})]}),e.jsx(we,{title:`Geothermal Generation Records (${v.startYear} - ${v.endYear})`,columns:ee,data:xe,loading:ye,selectable:!0,searchable:!0,exportable:!0,filterable:!0,refreshable:!0,pagination:!0,onExport:be,onRefresh:ve,tableClasses:{paper:"shadow-md rounded-md",headerCell:"bg-gray-50",row:"hover:bg-red-50"},emptyMessage:`No geothermal generation data available for years ${v.startYear} - ${v.endYear}`}),e.jsxs(te,{open:D,onClose:b,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(ne,{className:"flex justify-between items-center",children:[e.jsx(U,{variant:"h6",children:w?"Edit Record":"Add New Record"}),e.jsx(se,{onClick:b,size:"small",children:e.jsx(ue,{size:18})})]}),e.jsx(oe,{children:e.jsxs(le,{className:"p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Year"}),e.jsx(de,{initialYear:g,onYearChange:k})]}),e.jsx("div",{children:e.jsx($,{label:"Generation (GWh)",value:y,onChange:z,placeholder:"Enter generation value in GWh",variant:"outlined",size:"medium",min:0,step:.01,fullWidth:!0,error:!!f.errors.generation,helperText:f.errors.generation})}),e.jsx("div",{children:e.jsx($,{label:"Non-Renewable Energy (GWh)",value:S,onChange:u,placeholder:"Enter non-renewable energy value in GWh",variant:"outlined",size:"medium",min:0,step:.01,fullWidth:!0,error:!!f.errors.nonRenewableEnergy,helperText:f.errors.nonRenewableEnergy})}),e.jsx("div",{children:e.jsx($,{label:"Population (in millions)",value:Y,onChange:me,placeholder:"Enter population value in millions",variant:"outlined",size:"medium",min:0,step:.01,fullWidth:!0,error:!!f.errors.population,helperText:f.errors.population})}),e.jsx("div",{children:e.jsx($,{label:"Gross Domestic Product",value:R,onChange:ge,placeholder:"Enter GDP value",variant:"outlined",size:"medium",min:0,step:.01,fullWidth:!0,error:!!f.errors.gdp,helperText:f.errors.gdp})})]})}),e.jsxs(ie,{className:"p-4",children:[e.jsx(V,{variant:"secondary",onClick:b,className:"mr-2",children:"Cancel"}),e.jsx(V,{variant:"primary",onClick:Z,disabled:!f.isValid,className:"bg-red-500 hover:bg-red-600",children:w?"Update":"Save"})]})]}),e.jsxs(te,{open:D&&!w,onClose:b,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(ne,{className:"flex justify-between items-center",children:[e.jsx(U,{variant:"h6",children:"Add New Record"}),e.jsx(se,{onClick:b,size:"small",children:e.jsx(ue,{size:18})})]}),e.jsx(oe,{children:e.jsxs(le,{className:"p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Year"}),e.jsx(de,{initialYear:g,onYearChange:k})]}),e.jsx("div",{children:e.jsx($,{label:"Generation (GWh)",value:y,onChange:z,placeholder:"Enter generation value in GWh",variant:"outlined",size:"medium",min:0,step:.01,fullWidth:!0,error:!!f.errors.generation,helperText:f.errors.generation})})]})}),e.jsxs(ie,{className:"p-4",children:[e.jsx(V,{variant:"secondary",onClick:b,className:"mr-2",children:"Cancel"}),e.jsx(V,{variant:"primary",onClick:Z,disabled:!f.isValid,className:"bg-yellow-500 hover:bg-yellow-600",children:"Save"})]})]})]})};export{ga as default};
