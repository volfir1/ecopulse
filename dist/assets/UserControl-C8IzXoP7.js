import{as as pe,ap as Ue,a6 as we,T as V,at as je,r as u,ar as ye,j as e,an as Se,ao as be,au as k,B as y,P as xe,a as N,O as B,I as H,av as Ce,a4 as _,aw as ie,ax as ne,ay as oe,az as le,C as Ae,H as Re,a1 as ke,f as ce,ac as Le,aA as de,aB as Te}from"./index-BN0NLy4X.js";import{P as h}from"./index-CHCKNM3c.js";import{R as ze,a as Me,X as Fe,Y as Pe,T as Ie,L as Ve}from"./generateCategoricalChart-BNExA1pk.js";import{L as Oe,a as Z}from"./LineChart-D4A_n19b.js";import{T as ve,a as Q}from"./Tabs-DKSnhIHm.js";import{T as Ee}from"./TableContainer-DIUbz0im.js";import{T as $e,a as Ne,b as ee,c as C,d as qe}from"./TableRow-tWvjlUBP.js";import{C as me}from"./Chip-BQdj-Ugh.js";import{T as We}from"./TextField-Bsv3TW2t.js";import{u as G}from"./userService-89PvBtsH.js";import"./KeyboardArrowRight-YZSLJ-WA.js";import"./Select-BvIDhjGm.js";import"./axios-CmsuhreG.js";function Be(o){return Ue("MuiDialogContentText",o)}pe("MuiDialogContentText",["root"]);const He=o=>{const{classes:d}=o,S=be({root:["root"]},Be,d);return{...d,...S}},Je=we(V,{shouldForwardProp:o=>je(o)||o==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(o,d)=>d.root})({}),te=u.forwardRef(function(d,r){const S=ye({props:d,name:"MuiDialogContentText"}),{children:K,className:M,...F}=S,P=He(F);return e.jsx(Je,{component:"p",variant:"body1",color:"textSecondary",ref:r,ownerState:F,className:Se(P.root,M),...S,classes:P})}),he=k([e.jsx("path",{d:"M17 11c.34 0 .67.04 1 .09V6.27L10.5 3 3 6.27v4.91c0 4.54 3.2 8.79 7.5 9.82.55-.13 1.08-.32 1.6-.55-.69-.98-1.1-2.17-1.1-3.45 0-3.31 2.69-6 6-6"},"0"),e.jsx("path",{d:"M17 13c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 1.38c.62 0 1.12.51 1.12 1.12s-.51 1.12-1.12 1.12-1.12-.51-1.12-1.12.5-1.12 1.12-1.12m0 5.37c-.93 0-1.74-.46-2.24-1.17.05-.72 1.51-1.08 2.24-1.08s2.19.36 2.24 1.08c-.5.71-1.31 1.17-2.24 1.17"},"1")],"AdminPanelSettings"),ue=k(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12m8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8"}),"Block"),Ke=k(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),ge=k(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),se=k(e.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l4 4 4-4H6c0-3.86 3.14-7 7-7s7 3.14 7 7-3.14 7-7 7c-1.9 0-3.62-.76-4.88-1.99L6.7 18.42C8.32 20.01 10.55 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m2 8v-1c0-1.1-.9-2-2-2s-2 .9-2 2v1c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1m-1 0h-2v-1c0-.55.45-1 1-1s1 .45 1 1z"}),"LockReset"),Ye=k(e.jsx("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 14H4V8l8 5 8-5zm-8-7L4 6h16z"}),"MailOutline"),Ge=k(e.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert"),ae=k(e.jsx("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5s-3 1.34-3 3 1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"People"),Xe=k(e.jsx("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd"),_e=k(e.jsx("path",{d:"M19 4h-3.5l-1-1h-5l-1 1H5v2h14zM6 7v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7zm8 7v4h-4v-4H8l4-4 4 4z"}),"RestoreFromTrash"),Qe=k(e.jsx("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp"),Ze=k(e.jsx("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm-2 16-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9z"}),"VerifiedUser"),X=({title:o,value:d,icon:r,color:S})=>e.jsx(Ae,{elevation:1,sx:{borderRadius:"10px"},children:e.jsx(Re,{children:e.jsxs(y,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(y,{children:[e.jsx(V,{variant:"subtitle2",color:"textSecondary",sx:{mb:1},children:o}),e.jsx(V,{variant:"h3",component:"div",fontWeight:"bold",children:d})]}),e.jsx(ke,{sx:{bgcolor:S,width:56,height:56},children:r})]})})}),et=({data:o})=>{const d=o.statistics||{totalUsers:"0",activeUsers:"0",newUsers:"0",verifiedUsers:"0",deletedUsers:"0"},r=parseInt(d.totalUsers)-parseInt(d.activeUsers),S=o.activityData&&o.activityData.length>0?o.activityData:[{date:"Feb 19",totalVisits:7,activeUsers:4,newUsers:2},{date:"Feb 20",totalVisits:5,activeUsers:3,newUsers:1},{date:"Feb 21",totalVisits:6,activeUsers:4,newUsers:0},{date:"Feb 22",totalVisits:6,activeUsers:3,newUsers:2},{date:"Feb 23",totalVisits:8,activeUsers:4,newUsers:1},{date:"Feb 24",totalVisits:10,activeUsers:4,newUsers:3},{date:"Feb 25",totalVisits:4,activeUsers:3,newUsers:0}];return e.jsxs(y,{sx:{mt:4},children:[e.jsx(V,{variant:"h6",sx:{mb:2},children:"User Dashboard"}),e.jsxs(y,{sx:{display:"flex",flexWrap:"wrap",gap:3,mb:4},children:[e.jsx(y,{sx:{flex:"1 1 200px"},children:e.jsx(X,{title:"Total Users",value:d.totalUsers,icon:e.jsx(ae,{fontSize:"medium",sx:{color:"white"}}),color:"#34a853"})}),e.jsx(y,{sx:{flex:"1 1 200px"},children:e.jsx(X,{title:"Active Users",value:d.activeUsers,icon:e.jsx(Qe,{fontSize:"medium",sx:{color:"white"}}),color:"#8bc34a"})}),e.jsx(y,{sx:{flex:"1 1 200px"},children:e.jsx(X,{title:"New Users",value:d.newUsers,icon:e.jsx(Xe,{fontSize:"medium",sx:{color:"white"}}),color:"#2196f3"})}),e.jsx(y,{sx:{flex:"1 1 200px"},children:e.jsx(X,{title:"Verified Users",value:d.verifiedUsers,icon:e.jsx(Ze,{fontSize:"medium",sx:{color:"white"}}),color:"#ffc107"})}),e.jsx(y,{sx:{flex:"1 1 200px"},children:e.jsx(X,{title:"Inactive Users",value:r.toString(),icon:e.jsx(ue,{fontSize:"medium",sx:{color:"white"}}),color:"#f44336"})})]}),e.jsxs(xe,{elevation:1,sx:{p:3,borderRadius:"4px",border:"1px dashed #e0e0e0"},children:[e.jsx(V,{variant:"h6",sx:{mb:3},children:"User Activity"}),e.jsx(y,{sx:{height:300},children:e.jsx(ze,{width:"100%",height:"100%",children:e.jsxs(Oe,{data:S,margin:{top:10,right:30,left:0,bottom:10},children:[e.jsx(Me,{strokeDasharray:"3 3",vertical:!1}),e.jsx(Fe,{dataKey:"date"}),e.jsx(Pe,{}),e.jsx(Ie,{}),e.jsx(Ve,{wrapperStyle:{position:"relative",marginTop:"10px"}}),e.jsx(Z,{type:"monotone",dataKey:"totalVisits",name:"Total Visits",stroke:"#2196f3",strokeWidth:2,activeDot:{r:6}}),e.jsx(Z,{type:"monotone",dataKey:"activeUsers",name:"Active Users",stroke:"#4caf50",strokeWidth:2}),e.jsx(Z,{type:"monotone",dataKey:"newUsers",name:"New Users",stroke:"#ff9800",strokeWidth:2})]})})})]})]})},fe=({users:o,deletedUsers:d,handleEdit:r,handleSoftDelete:S,handleRestore:K,handleSendRecovery:M,handleSendPasswordReset:F,updateUserRole:P})=>{const[q,W]=u.useState(null),[v,O]=u.useState(null),[E,f]=u.useState(!1),[L,Y]=u.useState(""),[A,g]=u.useState({userId:null,userName:"",currentRole:"",newRole:"",confirmationPhrase:""}),[i,c]=u.useState({open:!1,title:"",message:"",confirmText:"",action:null}),[n,m]=u.useState(0),R=s=>{if(!s)return"Never";try{return new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(j){return console.error("Date formatting error:",j),"Invalid date"}},$=(s,j)=>{W(s.currentTarget),O(j)},T=()=>{W(null),O(null)},D=s=>{T();const j=s==="admin"?`make ${v.name} admin`:`remove admin from ${v.name}`;g({userId:v.id,userName:v.name,currentRole:v.role,newRole:s,confirmationPhrase:j}),f(!0)},b=()=>{f(!1),Y("")},t=async()=>{if(L===A.confirmationPhrase)try{const s=await P(A.userId,A.newRole);s.success?b():console.error("Failed to update role:",s.error)}catch(s){console.error("Error updating user role:",s)}},z=(s,j)=>{c({open:!0,title:"Confirm User Deactivation",message:`Are you sure you want to deactivate the user "${j}"? This action can be reversed later.`,confirmText:"Deactivate",action:()=>S(s)})},I=(s,j)=>{c({open:!0,title:"Confirm User Restoration",message:`Are you sure you want to restore the user "${j}"?`,confirmText:"Restore",action:()=>K(s)})},x=(s,j)=>{c({open:!0,title:"Send Recovery Link",message:`Are you sure you want to send a recovery link to "${j}" (${s})?`,confirmText:"Send Recovery Link",action:()=>M(s)})},a=(s,j)=>{c({open:!0,title:"Send Password Reset Link",message:`Are you sure you want to send a password reset link to "${j}" (${s})?`,confirmText:"Send Reset Link",action:()=>F(s)})},l=async()=>{i.action&&await i.action(),c({...i,open:!1})},p=(s,j)=>{m(j)},[U,w]=u.useState("all"),De=U==="all"?o:o.filter(s=>s.role===U),re=n===0?De:d;return e.jsxs(y,{sx:{mt:2},children:[e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(V,{variant:"h6",children:"Users Management"}),n===0&&e.jsxs(y,{children:[e.jsx(N,{variant:U==="all"?"contained":"outlined",size:"small",onClick:()=>w("all"),sx:{mr:1},children:"All Users"}),e.jsxs(N,{variant:U==="admin"?"contained":"outlined",size:"small",onClick:()=>w("admin"),sx:{mr:1},color:"primary",children:[e.jsx(he,{sx:{mr:.5,fontSize:18}}),"Admins"]}),e.jsxs(N,{variant:U==="user"?"contained":"outlined",size:"small",onClick:()=>w("user"),color:"info",children:[e.jsx(ae,{sx:{mr:.5,fontSize:18}}),"Regular Users"]})]})]}),e.jsx(y,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(ve,{value:n,onChange:p,TabIndicatorProps:{style:{height:"3px",backgroundColor:n===0?"#1b5e20":"#d32f2f"}},children:[e.jsx(Q,{label:"Active Users",icon:e.jsx(Ke,{}),iconPosition:"start",sx:{fontWeight:n===0?"bold":"normal",color:n===0?"#1b5e20":"inherit"}}),e.jsx(Q,{label:"Deactivated Users",icon:e.jsx(ue,{}),iconPosition:"start",sx:{fontWeight:n===1?"bold":"normal",color:n===1?"#d32f2f":"inherit"}})]})}),e.jsx(Ee,{component:xe,elevation:0,sx:{border:"1px solid #e0e0e0"},children:e.jsxs($e,{children:[e.jsx(Ne,{sx:{backgroundColor:n===0?"#f5f5f5":"#ffebee"},children:e.jsxs(ee,{children:[e.jsx(C,{children:"Name"}),e.jsx(C,{children:"Email"}),e.jsx(C,{children:"Role"}),e.jsx(C,{children:"Status"}),n===1&&e.jsx(C,{children:"Deactivated At"}),e.jsx(C,{children:n===0?"Last Active":"Created At"}),e.jsx(C,{align:"right",children:"Actions"})]})}),e.jsxs(qe,{children:[re.map(s=>e.jsxs(ee,{sx:{"&:last-child td, &:last-child th":{border:0},bgcolor:n===0&&s.role==="admin"?"rgba(27, 94, 32, 0.04)":n===1?"rgba(211, 47, 47, 0.04)":"transparent"},children:[e.jsx(C,{children:s.name}),e.jsx(C,{children:s.email}),e.jsx(C,{children:e.jsx(me,{label:s.role,color:s.role==="admin"?"primary":"default",size:"small",sx:{bgcolor:s.role==="admin"?"#1b5e20":"transparent",color:s.role==="admin"?"white":"inherit",fontWeight:500}})}),e.jsx(C,{children:e.jsx(me,{label:s.status,color:s.status==="active"?"success":s.status==="deleted"||s.status==="deactivated"?"error":"warning",size:"small",sx:{bgcolor:s.status==="active"?"#4caf50":s.status==="deleted"||s.status==="deactivated"?"#d32f2f":"#ff9800",color:"white",fontWeight:500}})}),n===1&&e.jsx(C,{children:R(s.deletedAt||s.deactivatedAt)}),e.jsx(C,{children:R(n===0?s.lastActive:s.createdAt)}),e.jsx(C,{align:"right",children:n===0?e.jsxs(e.Fragment,{children:[e.jsx(B,{title:"Send Password Reset Link",children:e.jsx(H,{size:"small",onClick:()=>a(s.email,s.name),color:"primary",sx:{mr:1},children:e.jsx(se,{fontSize:"small"})})}),e.jsx(B,{title:"Deactivate User",children:e.jsx(H,{size:"small",onClick:()=>z(s.id,s.name),color:"error",sx:{mr:1},children:e.jsx(ge,{fontSize:"small"})})}),e.jsx(B,{title:"More actions",children:e.jsx(H,{size:"small",onClick:j=>$(j,s),children:e.jsx(Ge,{fontSize:"small"})})})]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{title:"Send Reactivation Link",children:e.jsx(H,{size:"small",onClick:()=>x(s.email,s.name),color:"warning",sx:{mr:1},children:e.jsx(Ye,{fontSize:"small"})})}),e.jsx(B,{title:"Restore User",children:e.jsx(H,{size:"small",onClick:()=>I(s.id,s.name),color:"primary",sx:{mr:1},children:e.jsx(_e,{fontSize:"small"})})}),e.jsx(B,{title:"Send Password Reset Link",children:e.jsx(H,{size:"small",onClick:()=>a(s.email,s.name),color:"primary",children:e.jsx(se,{fontSize:"small"})})})]})})]},s.id)),re.length===0&&e.jsx(ee,{children:e.jsx(C,{colSpan:n===0?6:7,align:"center",sx:{py:3},children:e.jsx(V,{variant:"body1",color:"textSecondary",children:n===0?"No active users found":"No deactivated users found"})})})]})]})}),e.jsxs(Ce,{anchorEl:q,open:!!q,onClose:T,children:[v&&v.role!=="admin"&&e.jsxs(_,{onClick:()=>D("admin"),children:[e.jsx(he,{fontSize:"small",sx:{mr:1}}),"Make Admin"]}),v&&v.role==="admin"&&e.jsxs(_,{onClick:()=>D("user"),children:[e.jsx(ae,{fontSize:"small",sx:{mr:1}}),"Remove Admin Privileges"]}),v&&e.jsxs(_,{onClick:()=>{T(),a(v.email,v.name)},children:[e.jsx(se,{fontSize:"small",sx:{mr:1}}),"Send Password Reset"]}),v&&e.jsxs(_,{onClick:()=>{T(),z(v.id,v.name)},children:[e.jsx(ge,{fontSize:"small",sx:{mr:1},color:"error"}),"Deactivate User"]})]}),e.jsxs(ie,{open:E,onClose:b,children:[e.jsx(ne,{children:A.newRole==="admin"?"Grant Admin Privileges":"Remove Admin Privileges"}),e.jsxs(oe,{children:[e.jsx(te,{sx:{mb:2},children:A.newRole==="admin"?`You are about to grant admin privileges to ${A.userName}. This will give them full access to manage users and system settings.`:`You are about to remove admin privileges from ${A.userName}.`}),e.jsxs(te,{sx:{mb:2,fontWeight:"bold"},children:["To confirm, please type: ",e.jsx("span",{style:{color:"#1b5e20"},children:A.confirmationPhrase})]}),e.jsx(We,{autoFocus:!0,fullWidth:!0,value:L,onChange:s=>Y(s.target.value),error:L!==""&&L!==A.confirmationPhrase,helperText:L!==""&&L!==A.confirmationPhrase?"Text doesn't match":null})]}),e.jsxs(le,{children:[e.jsx(N,{onClick:b,children:"Cancel"}),e.jsx(N,{onClick:t,color:"primary",variant:"contained",disabled:L!==A.confirmationPhrase,children:"Confirm"})]})]}),e.jsxs(ie,{open:i.open,onClose:()=>c({...i,open:!1}),children:[e.jsx(ne,{children:i.title}),e.jsx(oe,{children:e.jsx(te,{children:i.message})}),e.jsxs(le,{children:[e.jsx(N,{onClick:()=>c({...i,open:!1}),children:"Cancel"}),e.jsx(N,{variant:"contained",color:i.confirmText==="Deactivate"?"error":i.confirmText==="Send Recovery Link"?"warning":"primary",onClick:l,children:i.confirmText})]})]})]})};fe.propTypes={users:h.arrayOf(h.shape({id:h.string.isRequired,name:h.string.isRequired,email:h.string.isRequired,role:h.string.isRequired,status:h.string.isRequired,lastActive:h.string})).isRequired,deletedUsers:h.arrayOf(h.shape({id:h.string.isRequired,name:h.string.isRequired,email:h.string.isRequired,role:h.string.isRequired,status:h.string.isRequired,deletedAt:h.string,createdAt:h.string})),handleEdit:h.func,handleSoftDelete:h.func.isRequired,handleRestore:h.func.isRequired,handleSendRecovery:h.func.isRequired,handleSendPasswordReset:h.func.isRequired,updateUserRole:h.func.isRequired};const J={usersList:[{id:"user1",name:"John Smith",email:"john.smith@example.com",role:"admin",status:"active",lastActive:new Date().toISOString(),isDeactivated:!1,createdAt:new Date(new Date().setDate(new Date().getDate()-120)).toISOString()},{id:"user2",name:"Jane Doe",email:"jane.doe@example.com",role:"user",status:"active",lastActive:new Date().toISOString(),isDeactivated:!1,createdAt:new Date(new Date().setDate(new Date().getDate()-60)).toISOString()},{id:"user3",name:"Robert Johnson",email:"robert.johnson@example.com",role:"user",status:"unverified",lastActive:null,isDeactivated:!1,createdAt:new Date(new Date().setDate(new Date().getDate()-10)).toISOString()},{id:"user4",name:"Emily Brown",email:"emily.brown@example.com",role:"user",status:"active",lastActive:new Date(new Date().setDate(new Date().getDate()-5)).toISOString(),isDeactivated:!1,createdAt:new Date(new Date().setDate(new Date().getDate()-45)).toISOString()},{id:"user5",name:"Michael Wilson",email:"michael.wilson@example.com",role:"admin",status:"inactive",lastActive:new Date(new Date().setDate(new Date().getDate()-32)).toISOString(),isDeactivated:!1,createdAt:new Date(new Date().setDate(new Date().getDate()-150)).toISOString()}],deletedUsers:[{id:"user6",name:"Sarah Miller",email:"sarah.miller@example.com",role:"user",status:"deactivated",lastActive:new Date(new Date().setDate(new Date().getDate()-90)).toISOString(),isDeactivated:!0,createdAt:new Date(new Date().setDate(new Date().getDate()-180)).toISOString(),deactivatedAt:new Date(new Date().setDate(new Date().getDate()-15)).toISOString()},{id:"user7",name:"David Taylor",email:"david.taylor@example.com",role:"user",status:"deactivated",lastActive:new Date(new Date().setDate(new Date().getDate()-120)).toISOString(),isDeactivated:!0,createdAt:new Date(new Date().setDate(new Date().getDate()-200)).toISOString(),deactivatedAt:new Date(new Date().setDate(new Date().getDate()-30)).toISOString()}],statistics:{totalUsers:"5",activeUsers:"3",newUsers:"1",verifiedUsers:"4",deletedUsers:"2"},activityData:[{date:"Mar 13",totalVisits:7,activeUsers:4,newUsers:2},{date:"Mar 14",totalVisits:5,activeUsers:3,newUsers:1},{date:"Mar 15",totalVisits:6,activeUsers:4,newUsers:0},{date:"Mar 16",totalVisits:6,activeUsers:3,newUsers:2},{date:"Mar 17",totalVisits:8,activeUsers:4,newUsers:1},{date:"Mar 18",totalVisits:10,activeUsers:4,newUsers:3},{date:"Mar 19",totalVisits:4,activeUsers:3,newUsers:0}]},tt=()=>{const[o,d]=u.useState({usersList:[],deletedUsers:[],statistics:{totalUsers:"0",activeUsers:"0",newUsers:"0",verifiedUsers:"0",deletedUsers:"0"},activityData:[]}),[r,S]=u.useState(!0),[K,M]=u.useState(null),[F,P]=u.useState(null),[q,W]=u.useState(0),v=u.useCallback(()=>{console.log("Refreshing user management data..."),W(g=>g+1)},[]);u.useEffect(()=>{(async()=>{try{S(!0),M(null);let i=[],c=[],n={},m=[];try{console.log("Fetching all users...");const D=await G.getAllUsers();console.log("getAllUsers response:",D),i=(D==null?void 0:D.users)||[],console.log("Fetching users with deleted...");const b=await G.getAllDeactivated();console.log("getAllDeactivated response:",b);const t=(b==null?void 0:b.users)||[];t.length>0&&(console.log("Sample user properties:",Object.keys(t[0])),console.log("Sample user data:",JSON.stringify(t[0],null,2))),c=t.filter(a=>{const l=a.isDeactivated===!0,p=a.isAutoDeactivated===!0,U=a.status==="deleted"||a.status==="deactivated",w=a.status==="inactive"&&a.deactivatedAt;return(l||p||U||w)&&console.log(`Deactivated user found: ${a.email||a.name}`,{isDeactivated:l,isAutoDeactivated:p,hasDeletedStatus:U,isInactive:w,status:a.status,deactivatedAt:a.deactivatedAt}),l||p||U||w}),console.log(`Found ${c.length} deleted/deactivated users`),i=i.filter(a=>!a.isDeactivated&&!a.isAutoDeactivated&&a.status!=="deleted"&&a.status!=="deactivated");const z=i.filter(a=>a.lastLogin).length,I=i.filter(a=>{const l=new Date(a.createdAt),p=new Date,U=new Date(p.setDate(p.getDate()-30));return l>=U}).length,x=i.filter(a=>a.isVerified).length;if(n={totalUsers:i.length.toLocaleString(),activeUsers:z.toLocaleString(),newUsers:I.toLocaleString(),verifiedUsers:x.toLocaleString(),deletedUsers:c.length.toLocaleString()},t.length>0){const a={},l=new Date;for(let p=6;p>=0;p--){const U=new Date(l);U.setDate(U.getDate()-p);const w=U.toLocaleDateString("en-US",{month:"short",day:"numeric"});a[w]={date:w,totalVisits:0,activeUsers:0,newUsers:0}}t.forEach(p=>{if(p.lastLogin){const w=new Date(p.lastLogin).toLocaleDateString("en-US",{month:"short",day:"numeric"});a[w]&&(a[w].totalVisits++,a[w].activeUsers++)}if(p.createdAt){const w=new Date(p.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric"});a[w]&&a[w].newUsers++}}),m=Object.values(a)}else m=D.userActivity||J.activityData}catch(D){console.error("API fetch failed, using mock data:",D),console.log("Using mock data as fallback"),i=J.usersList,n=J.statistics,m=J.activityData,c=J.deletedUsers||[]}const R=(D,b=!1)=>Array.isArray(D)?D.map(t=>{console.log("Formatting user:",t.email||t._id||"unknown",`isDeactivated=${b}, status=${t.status}`,`isDeactivated flag=${t.isDeactivated}, isAutoDeactivated=${t.isAutoDeactivated}`);const z=(t==null?void 0:t.firstName)||"",I=(t==null?void 0:t.lastName)||"",x=(t==null?void 0:t.name)||`${z} ${I}`.trim();let a="unknown";return b||(t==null?void 0:t.isDeactivated)===!0||(t==null?void 0:t.isAutoDeactivated)===!0?a="deactivated":t!=null&&t.status?a=t.status:(t==null?void 0:t.isVerified)===!1?a="unverified":t!=null&&t.lastLogin?a="active":a="inactive",{id:(t==null?void 0:t._id)||(t==null?void 0:t.id)||"unknown-id",name:x||"Unnamed User",email:(t==null?void 0:t.email)||"no-email",role:(t==null?void 0:t.role)||"user",status:a,lastActive:(t==null?void 0:t.lastActive)||(t==null?void 0:t.lastLogin)||(t==null?void 0:t.updatedAt)||new Date,isDeactivated:b||(t==null?void 0:t.isDeactivated)===!0||(t==null?void 0:t.isAutoDeactivated)===!0,createdAt:(t==null?void 0:t.createdAt)||new Date,deactivatedAt:(t==null?void 0:t.deletedAt)||(t==null?void 0:t.deactivatedAt)||null}}):(console.error("Expected users to be an array but got:",typeof D),[]),$=R(i),T=R(c,!0);console.log(`Formatted ${$.length} active users and ${T.length} deleted users`),d({usersList:$,deletedUsers:T,statistics:n,activityData:m})}catch(i){console.error("Failed to process users data:",i),M(i.message||"An error occurred while fetching user data"),d(J)}finally{S(!1)}})()},[q]);const O=async g=>{try{const i=await G.deactivateUser(g);if(i.success){const c=o.usersList.find(n=>n.id===g);if(c){const n={...c,status:"deactivated",isDeactivated:!0,deactivatedAt:new Date().toISOString()};d(m=>({...m,usersList:m.usersList.filter(R=>R.id!==g),deletedUsers:[...m.deletedUsers,n],statistics:{...m.statistics,activeUsers:(parseInt(m.statistics.activeUsers.replace(/,/g,""),10)-1).toLocaleString(),deletedUsers:(parseInt(m.statistics.deletedUsers.replace(/,/g,""),10)+1).toLocaleString()}}))}return{success:!0,message:"User successfully deactivated"}}else throw new Error(i.message||"Failed to deactivate user")}catch(i){return console.error("Failed to deactivate user:",i),{success:!1,error:{message:i.message||"Failed to deactivate user"}}}};return{data:o,setData:d,loading:r,error:K,selectedUser:F,setSelectedUser:P,handleDeactivateUser:O,handleRestoreUser:async g=>{try{const i=await G.restoreUser(g);if(i.success){const c=o.deletedUsers.find(n=>n.id===g);if(c){const n={...c,status:"active",isDeactivated:!1,lastActive:new Date().toISOString()};d(m=>({...m,deletedUsers:m.deletedUsers.filter(R=>R.id!==g),usersList:[...m.usersList,n],statistics:{...m.statistics,totalUsers:(parseInt(m.statistics.totalUsers.replace(/,/g,""),10)+1).toLocaleString(),deletedUsers:(parseInt(m.statistics.deletedUsers.replace(/,/g,""),10)-1).toLocaleString()}}))}return{success:!0,message:"User successfully restored"}}else throw new Error(i.message||"Failed to restore user")}catch(i){return console.error("Failed to restore user:",i),{success:!1,error:{message:i.message||"Failed to restore user"}}}},handleSendRecoveryLink:async g=>{try{const i=await ce.requestAccountRecovery(g);if(i.success)return{success:!0,message:"Recovery link sent successfully"};throw new Error(i.message||"Failed to send recovery link")}catch(i){return console.error("Failed to send recovery link:",i),{success:!1,error:{message:i.message||"Failed to send recovery link"}}}},handleSendPasswordResetLink:async g=>{try{const i=await ce.forgotPassword(g);if(i.success)return{success:!0,message:"Password reset link sent successfully"};throw new Error(i.message||"Failed to send password reset link")}catch(i){return console.error("Failed to send password reset link:",i),{success:!1,error:{message:i.message||"Failed to send password reset link"}}}},updateUserRole:async(g,i)=>{try{const c=await G.updateUserRole(g,i);if(c.success)return d(n=>({...n,usersList:n.usersList.map(m=>m.id===g?{...m,role:i,lastActive:new Date().toISOString()}:m)})),{success:!0,message:c.message};throw new Error(c.message||"Failed to update role")}catch(c){return console.error("Error updating user role:",c),{success:!1,error:{message:c.message||"Failed to update user role"}}}},refreshData:v,handleSoftDeleteUser:O}};function vt(){var $,T,D,b,t,z,I;const[o,d]=u.useState(0),{data:r,loading:S,selectedUser:K,setSelectedUser:M,handleRestoreUser:F,handleSendRecoveryLink:P,handleSendPasswordResetLink:q,updateUserRole:W,handleDeactivateUser:v,refreshData:O}=tt(),[E,f]=u.useState({open:!1,message:"",severity:"success"});u.useEffect(()=>{var x,a;console.log("UserControl data:",r),console.log("UsersList available:",((x=r==null?void 0:r.usersList)==null?void 0:x.length)||0),console.log("DeletedUsers available:",((a=r==null?void 0:r.deletedUsers)==null?void 0:a.length)||0)},[r]);const L=(x,a)=>{d(a)},Y=x=>{console.log("Edit user:",x),M(x)},A=async x=>{var a;try{const l=await v(x);l.success?f({open:!0,message:"User has been successfully deactivated",severity:"success"}):f({open:!0,message:((a=l.error)==null?void 0:a.message)||"Failed to deactivate user",severity:"error"})}catch(l){console.error("Error in deactivating user:",l),f({open:!0,message:"An error occurred while deactivating the user",severity:"error"})}},g=async x=>{var a;try{const l=await F(x);l.success?(f({open:!0,message:"User has been successfully restored",severity:"success"}),O()):f({open:!0,message:((a=l.error)==null?void 0:a.message)||"Failed to restore user",severity:"error"})}catch(l){console.error("Error in restoring user:",l),f({open:!0,message:"An error occurred while restoring the user",severity:"error"})}},i=async x=>{var a;try{const l=await P(x);l.success?f({open:!0,message:"Reactivation link has been sent to the user",severity:"success"}):f({open:!0,message:((a=l.error)==null?void 0:a.message)||"Failed to send reactivation link",severity:"error"})}catch(l){console.error("Error in sending recovery link:",l),f({open:!0,message:"An error occurred while sending reactivation link",severity:"error"})}},c=async x=>{var a;try{const l=await q(x);l.success?f({open:!0,message:"Password reset link has been sent to the user",severity:"success"}):f({open:!0,message:((a=l.error)==null?void 0:a.message)||"Failed to send password reset link",severity:"error"})}catch(l){console.error("Error in sending password reset:",l),f({open:!0,message:"An error occurred while sending password reset link",severity:"error"})}},n=()=>{f({...E,open:!1})},m=!r||!r.usersList||r.usersList.length===0;if(S)return e.jsx(y,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"300px"},children:e.jsx(Le,{})});const R={...r,usersList:(r==null?void 0:r.usersList)||[],deletedUsers:(r==null?void 0:r.deletedUsers)||[],statistics:{...(r==null?void 0:r.statistics)||{},totalUsers:(($=r==null?void 0:r.statistics)==null?void 0:$.totalUsers)||"0",activeUsers:((T=r==null?void 0:r.statistics)==null?void 0:T.activeUsers)||"0",newUsers:((D=r==null?void 0:r.statistics)==null?void 0:D.newUsers)||"0",verifiedUsers:((b=r==null?void 0:r.statistics)==null?void 0:b.verifiedUsers)||"0",deletedUsers:((t=r==null?void 0:r.statistics)==null?void 0:t.deletedUsers)||"0",inactiveUsers:parseInt(((z=r==null?void 0:r.statistics)==null?void 0:z.totalUsers)||0)-parseInt(((I=r==null?void 0:r.statistics)==null?void 0:I.activeUsers)||0)},activityData:(r==null?void 0:r.activityData)||[]};return e.jsxs(y,{sx:{p:3,maxWidth:"100%"},children:[e.jsx(V,{variant:"h5",component:"h1",fontWeight:"medium",sx:{mb:2},children:"User Management"}),m&&e.jsx(de,{severity:"warning",sx:{mb:2},children:"No user data available. This could be a data fetching issue or empty database."}),e.jsx(y,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(ve,{value:o,onChange:L,TabIndicatorProps:{style:{height:"3px",backgroundColor:"#1b5e20"}},children:[e.jsx(Q,{label:"DASHBOARD",sx:{fontWeight:o===0?"bold":"normal",color:o===0?"#1b5e20":"inherit"}}),e.jsx(Q,{label:"USERS LIST",sx:{fontWeight:o===1?"bold":"normal",color:o===1?"#1b5e20":"inherit"}})]})}),o===0&&e.jsx(et,{data:R}),o===1&&e.jsx(fe,{users:R.usersList,deletedUsers:R.deletedUsers,handleEdit:Y,handleSoftDelete:A,handleRestore:g,handleSendRecovery:i,handleSendPasswordReset:c,updateUserRole:W}),e.jsx(Te,{open:E.open,autoHideDuration:6e3,onClose:n,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(de,{onClose:n,severity:E.severity,variant:"filled",sx:{width:"100%"},children:E.message})})]})}export{vt as default};
