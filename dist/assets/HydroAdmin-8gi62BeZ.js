import{e as Ee,r as a,R as Ce,j as e,Y as K,aa as De,q as X,T as J,aw as ne,ax as se,I as oe,ay as le,B as ie,Z as z,az as de,$ as _}from"./index-BN0NLy4X.js";import{S as ce}from"./SingleYearPicker-vaKepwjh.js";import{Y as ke}from"./YearPicker-Bqs4Knph.js";import{D as Ge}from"./DataTable-Bk0dGK5n.js";import{u as Ne}from"./useDataTable-MXgyYZKv.js";import{a as T}from"./api-DsXL_j3W.js";import{E as Se,h as Ye}from"./html2canvas.esm-sb2Cu8V0.js";import{D as ue}from"./droplets-CE_WW2Hy.js";import{R as Pe,a as Re,X as Fe,Y as We,T as Ae}from"./generateCategoricalChart-BNExA1pk.js";import{L as Me,a as ze}from"./LineChart-D4A_n19b.js";import{X as he}from"./x-DDYGCXAs.js";import"./AdapterDayjs-BpcbILur.js";import"./index-B8U9fKH1.js";import"./useThemeProps-CQcjcwiv.js";import"./index-CHCKNM3c.js";import"./Select-BvIDhjGm.js";import"./TextField-Bsv3TW2t.js";import"./Chip-BQdj-Ugh.js";import"./refresh-ccw-DgaJWPi_.js";import"./download-BiV-z_yu.js";import"./TableContainer-DIUbz0im.js";import"./TableRow-tWvjlUBP.js";import"./SwitchBase-Rw-G-Ulq.js";import"./chevron-up-DjS0qExE.js";import"./KeyboardArrowRight-YZSLJ-WA.js";import"./axios-CmsuhreG.js";import"./typeof-QjJsDpFa.js";const Te=()=>{const o=Ee(),r=(o==null?void 0:o.enqueueSnackbar)||(t=>console.log("Snackbar message:",t)),[i,v]=a.useState([]),[h,p]=a.useState(null),[P,d]=a.useState(!0),[j,$]=a.useState(new Date().getFullYear()),[w,L]=a.useState(new Date().getFullYear()+5),[I,D]=a.useState(0),k=a.useRef(null),H=t=>t.replace(/NaN/g,"null"),B=a.useCallback(async(t,s)=>{d(!0);try{const l=await T.get(`/api/predictions/hydro/?start_year=${t}&end_year=${s}`),x=typeof l.data=="string"?l.data:JSON.stringify(l.data),M=H(x),C=JSON.parse(M);if(C.status==="success"&&Array.isArray(C.predictions)){const y=C.predictions.map(c=>({date:c.Year,value:parseFloat(c["Predicted Production"]),nonRenewableEnergy:c.isPredicted?null:c["Non-Renewable Energy (GWh)"]?parseFloat(c["Non-Renewable Energy (GWh)"]):null,population:c.isPredicted?null:c["Population (in millions)"]?parseFloat(c["Population (in millions)"]):null,gdp:c.isPredicted||c["Gross Domestic Product"]===null?null:parseFloat(c["Gross Domestic Product"]),isPredicted:c.isPredicted!==void 0?c.isPredicted:!1,isDeleted:c.isDeleted!==void 0?c.isDeleted:!1}));console.log("Raw fetched data:",C.predictions),console.log("Formatted data:",y),v(y)}else throw new Error("Invalid data format in API response")}catch(l){console.error("Error fetching data:",l),r("Failed to fetch data. Please try again.",{variant:"error"})}finally{d(!1)}},[r]);a.useEffect(()=>{B(j,w)},[j,w,I]);const G=a.useCallback(t=>{$(t)},[]),m=a.useCallback(t=>{L(t)},[]),R=a.useCallback(()=>{D(t=>t+1)},[]),f=a.useCallback(async()=>{try{try{r("Preparing your download...",{variant:"info"})}catch{console.log("Preparing download...")}const t=new Se({orientation:"portrait",unit:"mm",format:"a4"});if(t.setFontSize(16),t.text("Hydro Power Generation Summary",15,15),t.setFontSize(11),t.text(`Year Range: ${j} - ${w}`,15,25),t.text(`Current Projection: ${h?h.toFixed(2):"N/A"} GWh`,15,30),t.text(`Generated on: ${new Date().toLocaleDateString()}`,15,35),k.current)try{const l=k.current,M=(await Ye(l,{scale:2,useCORS:!0,logging:!1})).toDataURL("image/png");t.addImage(M,"PNG",15,45,180,80),t.setFontSize(12),t.text("Hydro Power Generation Chart",15,45)}catch(l){console.error("Error capturing chart:",l)}const s=k.current?140:45;t.setFontSize(12),t.text("Geothermal Generation Data Table",15,s-5),t.autoTable({head:[["Year","Predicted Production (GWh)"]],body:i.map(l=>[l.date,l.value.toFixed(2)]),startY:s,margin:{left:15,right:15},headStyles:{fillColor:[255,107,107]},styles:{fontSize:10,cellPadding:3}}),t.save("Hydro_Power_Generation_Summary.pdf");try{r("Summary downloaded successfully!",{variant:"success"})}catch{console.log("Summary downloaded successfully!")}}catch(t){console.error("Download error:",t);try{r("Failed to download summary. Please try again.",{variant:"error"})}catch(s){console.error("Error showing notification:",s),alert("Failed to download summary. Please try again.")}}},[i,j,w,h,r,k]),F=Array.from({length:7},(t,s)=>({day:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"][s],surface:150+Math.sin(s*.5)*10+Math.random()*5,deep:280+Math.sin(s*.3)*5+Math.random()*3})),N=Array.from({length:6},(t,s)=>({well:`Well ${s+1}`,pressure:85+Math.sin(s*.7)*10+Math.random()*5,output:2600+Math.sin(s*.6)*300+Math.random()*200})),W=a.useCallback(async(t,s)=>{d(!0);try{const l={Year:t,"Geothermal (GWh)":s};await T.post("/api/predictions/hydro/",l);try{r("Geothermal generation data added successfully",{variant:"success"})}catch{console.log("Geothermal generation data added successfully")}D(x=>x+1)}catch(l){console.error("Error adding data:",l);try{r("Failed to add hydrpo generation data",{variant:"error"})}catch(x){console.error("Error showing notification:",x)}}finally{d(!1)}},[r]),S=a.useCallback(async(t,s)=>{d(!0);try{await T.put(`/api/update/${t}/`,s);try{r("Geothermal generation data updated successfully",{variant:"success"})}catch{console.log("Geothermal generation data updated successfully")}D(l=>l+1)}catch(l){console.error("Error updating data:",l);try{r("Failed to update hydro generation data",{variant:"error"})}catch(x){console.error("Error showing notification:",x)}}finally{d(!1)}},[r]),A=a.useCallback(async t=>{d(!0);try{await T.put(`/api/update/${t}/`,{isDeleted:!0});try{r("Geothermal generation data deleted successfully",{variant:"success"})}catch{console.log("Geothermal generation data deleted successfully")}D(s=>s+1)}catch(s){console.error("Error deleting data:",s);try{r("Failed to delete hydro generation data",{variant:"error"})}catch(l){console.error("Error showing notification:",l)}}finally{d(!1)}},[r]),Y=a.useCallback(async t=>{d(!0);try{await T.put(`/api/recover/${t}/`,{isDeleted:!1});try{r("Geothermal generation data recovered successfully",{variant:"success"})}catch{console.log("Geothermal generation data deleted successfully")}D(s=>s+1)}catch(s){console.error("Error recovering data:",s);try{r("Failed to recover hydro generation data",{variant:"error"})}catch(l){console.error("Error showing notification:",l)}}finally{d(!1)}},[r]);return{generationData:i,currentProjection:h,loading:P,selectedStartYear:j,selectedEndYear:w,handleStartYearChange:G,handleEndYearChange:m,handleRefresh:R,handleDownload:f,addRecord:W,updateRecord:S,deleteRecord:A,recoverRecord:Y,temperatureData:F,wellPerformance:N,chartRef:k}},$e=(o,r,i,v)=>[{id:"year",label:"Year",align:"left",sortable:!0},{id:"generation",label:"Generation (GWh)",align:"right",sortable:!0,format:h=>h?h.toFixed(2):"0.00"},{id:"dateAdded",label:"Date Added",align:"center",sortable:!0,format:h=>h?new Date(h).toLocaleDateString():"-"},{id:"actions",label:"Actions",align:"center",sortable:!1,format:(h,p)=>p.isPredicted===!1&&!p.isDeleted?e.jsx(me,{row:p,onEdit:o,onDelete:r}):p.isPredicted===!1&&p.isDeleted===!0?e.jsx(me,{row:p,onRecover:i}):null}],me=Ce.memo(({row:o,onEdit:r,onDelete:i,onRecover:v})=>{const h=d=>{d.stopPropagation(),r(o)},p=d=>{d.stopPropagation(),i(o.year)},P=d=>{d.stopPropagation(),v(o.year)};return e.jsxs("div",{className:"flex justify-center gap-2",children:[r&&e.jsx("button",{onClick:h,className:"p-1 text-blue-600 hover:text-blue-800 hover:bg-blue-100 rounded-full transition-colors",title:"Edit",children:e.jsx(K,{name:"edit",size:18})}),i&&e.jsx("button",{onClick:p,className:"p-1 text-red-600 hover:text-red-800 hover:bg-red-100 rounded-full transition-colors",title:"Delete",children:e.jsx(K,{name:"trash",size:18})}),v&&e.jsx("button",{onClick:P,className:"p-1 text-green-600 hover:text-green-800 hover:bg-green-100 rounded-full transition-colors",title:"Recover",children:e.jsx(K,{name:"refresh",size:18})})]})}),Le=o=>!o||o.length===0?[]:[...o].sort((r,i)=>r.year-i.year).map(r=>({year:r.year.toString(),value:r.generation})),Ie=()=>{De.palette;const o="#FF6B6B";return{bar:{dataKey:"value",fill:o,radius:[4,4,0,0],barSize:30,name:"Generation (GWh)"},tooltip:{formatter:r=>[`${r.toFixed(2)} GWh`,"Generation"],labelFormatter:r=>`Year: ${r}`},xAxis:{dataKey:"year",axisLine:{stroke:"#E0E0E0"},tickLine:!1},yAxis:{axisLine:{stroke:"#E0E0E0"},tickLine:!1,label:""},line:{stroke:o,strokeWidth:2,dot:{r:4,fill:o,stroke:"#fff",strokeWidth:2},activeDot:{r:6,fill:o,stroke:"#fff",strokeWidth:2}}}},Be=(o,r)=>{const i={};return o?(o<1900||o>2100)&&(i.year="Year must be between 1900 and 2100"):i.year="Year is required",r?(isNaN(r)||parseFloat(r)<=0)&&(i.generation="Generation must be a positive number"):i.generation="Generation value is required",{isValid:Object.keys(i).length===0,errors:i}},Oe=()=>{const o=new Date().getFullYear();return Array.from({length:8},(r,i)=>({id:i+1,year:o-4+i,generation:900+Math.random()*300+i*60,dateAdded:new Date(Date.now()-i*864e5).toISOString()}))},_e=(o,r)=>r.map(i=>i.year===o?{...i,isDeleted:!1}:i),ya=()=>{const{generationData:o,currentProjection:r,loading:i,selectedStartYear:v,selectedEndYear:h,handleStartYearChange:p,handleEndYearChange:P,handleRefresh:d,handleDownload:j,addRecord:$,updateRecord:w,deleteRecord:L,recoverRecord:I,temperatureData:D,wellPerformance:k,chartRef:H}=Te(),[B,G]=a.useState(!1),[m,R]=a.useState(new Date().getFullYear()),[f,F]=a.useState(""),[N,W]=a.useState(""),[S,A]=a.useState(""),[Y,t]=a.useState(""),[s,l]=a.useState(!1),[x,M]=a.useState(null);a.useCallback(()=>{l(!1),R(new Date().getFullYear()),F(""),W(""),A(""),t(""),G(!0)},[]);const C=a.useCallback(n=>{var u,O,re,te;l(!0),M(n.id),R(n.year||new Date().getFullYear()),F(((u=n.generation)==null?void 0:u.toString())||""),W(((O=n.nonRenewableEnergy)==null?void 0:O.toString())||""),A(((re=n.population)==null?void 0:re.toString())||""),t(((te=n.gdp)==null?void 0:te.toString())||""),G(!0),console.log("Editing row:",n)},[]),y=a.useCallback(()=>{G(!1)},[]),c=a.useCallback(n=>{R(n)},[]),U=a.useCallback(n=>{F(n.target.value)},[]),ge=a.useCallback(n=>{W(n.target.value)},[]),pe=a.useCallback(n=>{A(n.target.value)},[]),fe=a.useCallback(n=>{t(n.target.value)},[]),Z=a.useCallback(async n=>{if(window.confirm("Are you sure you want to delete this record?"))try{await L(n)}catch(u){console.error("Error deleting data:",u)}},[L]),Q=a.useCallback(async n=>{try{await I(n),setGenerationData(u=>_e(n,u))}catch(u){console.error("Error recovering data:",u)}},[I]),ee=a.useCallback(async()=>{if(!(!m||!f||!N||!S||!Y))try{G(!1);const n={Year:m,"Hydro (GWh)":parseFloat(f),"Non-Renewable Energy (GWh)":parseFloat(N),"Population (in millions)":parseFloat(S),"Gross Domestic Product":parseFloat(Y)};s?await w(m,n):await $(m,n["Geothermal (GWh)"])}catch(n){console.error("Error saving data:",n)}},[m,f,N,S,Y,s,w,$]),xe=a.useCallback(()=>{j()},[j]),V=a.useMemo(()=>{if(o.length>0){const n=o.map((u,O)=>({id:O+1,year:u.date,generation:u.value,nonRenewableEnergy:u.nonRenewableEnergy,population:u.population,gdp:u.gdp,dateAdded:new Date().toISOString(),isPredicted:u.isPredicted!==void 0?u.isPredicted:!1,isDeleted:u.isDeleted!==void 0?u.isDeleted:!1}));return console.log("Effective data:",n),n}return Oe().map(n=>({...n,isPredicted:!0}))},[o]),b=a.useMemo(()=>({startYear:v,endYear:h}),[v,h]),q=a.useMemo(()=>V.filter(n=>n.year>=b.startYear&&n.year<=b.endYear),[V,b]),ye=a.useMemo(()=>Le(q),[q]),ae=a.useMemo(()=>$e(C,Z,Q),[C,Z,Q,V]),{data:be,loading:ve,handleExport:je,handleRefresh:we}=Ne({data:q,columns:ae,onExport:xe,onRefresh:d}),E=a.useMemo(()=>{const n=Ie();return n.line={stroke:"#2E90E5",strokeWidth:2,dot:{r:5,fill:"#2E90E5",stroke:"#fff",strokeWidth:2},activeDot:{r:7,fill:"#2E90E5",stroke:"#fff",strokeWidth:2}},n.yAxis={...n.yAxis,label:{value:"Generation (GWh)",angle:-90,position:"insideLeft",style:{textAnchor:"middle"},offset:-5}},n},[]),g=a.useMemo(()=>m&&f?Be(m,f):{isValid:!1,errors:{}},[m,f]);return i&&o.length===0?e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:e.jsx(ue,{className:"text-blue-500",size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Hydropower Generation Data"}),e.jsx("p",{className:"text-gray-500",children:"Loading hydropower generation data..."})]})]})}),e.jsx(X.Base,{className:"mb-6 p-4 flex justify-center items-center h-96",children:e.jsxs("div",{className:"animate-pulse flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-200 rounded-full mb-4"}),e.jsx("div",{className:"h-4 w-36 bg-blue-200 rounded mb-2"}),e.jsx("div",{className:"h-3 w-24 bg-blue-200 rounded"})]})})]}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:e.jsx(ue,{className:"text-blue-500",size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Hydropower Generation Data"}),e.jsx("p",{className:"text-gray-500",children:"Manage historical and projected hydropower generation data"})]})]})}),e.jsx(X.Base,{className:"mb-6 p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(J,{variant:"h6",className:"text-gray-700",children:"Filter Data By Year Range"}),e.jsx("div",{className:"min-w-64",children:e.jsx(ke,{initialStartYear:b.startYear,initialEndYear:b.endYear,onStartYearChange:p,onEndYearChange:P})})]})}),e.jsxs(X.Base,{className:"mb-6 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-medium",children:"Generation Overview"}),r&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-gray-500",children:"Latest Projection:"}),e.jsxs("span",{className:"ml-2 text-xl font-semibold text-red-600",children:[r.toFixed(2)," GWh"]})]})]}),e.jsx("div",{className:"p-6 h-96",ref:H,children:e.jsx(Pe,{width:"100%",height:"100%",children:e.jsxs(Me,{data:ye,margin:{top:15,right:30,left:20,bottom:5},children:[e.jsx(Re,{strokeDasharray:"3 3"}),e.jsx(Fe,{...E.xAxis}),e.jsx(We,{...E.yAxis}),e.jsx(Ae,{formatter:E.tooltip.formatter,labelFormatter:E.tooltip.labelFormatter}),e.jsx(ze,{type:"monotone",dataKey:"value",stroke:E.line.stroke,strokeWidth:E.line.strokeWidth,dot:E.line.dot,activeDot:E.line.activeDot,name:"Generation (GWh)"})]})})})]}),e.jsx(Ge,{title:`Hydro Power Generation Records (${b.startYear} - ${b.endYear})`,columns:ae,data:be,loading:ve,selectable:!0,searchable:!0,exportable:!0,filterable:!0,refreshable:!0,pagination:!0,onExport:je,onRefresh:we,tableClasses:{paper:"shadow-md rounded-md",headerCell:"bg-gray-50",row:"hover:bg-red-50"},emptyMessage:`No geothermal generation data available for years ${b.startYear} - ${b.endYear}`}),e.jsxs(ne,{open:B,onClose:y,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(se,{className:"flex justify-between items-center",children:[e.jsx(J,{variant:"h6",children:s?"Edit Record":"Add New Record"}),e.jsx(oe,{onClick:y,size:"small",children:e.jsx(he,{size:18})})]}),e.jsx(le,{children:e.jsxs(ie,{className:"p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Year"}),e.jsx(ce,{initialYear:m,onYearChange:c})]}),e.jsx("div",{children:e.jsx(z,{label:"Generation (GWh)",value:f,onChange:U,placeholder:"Enter generation value in GWh",variant:"outlined",size:"medium",min:0,step:.01,fullWidth:!0,error:!!g.errors.generation,helperText:g.errors.generation})}),e.jsx("div",{children:e.jsx(z,{label:"Non-Renewable Energy (GWh)",value:N,onChange:ge,placeholder:"Enter non-renewable energy value in GWh",variant:"outlined",size:"medium",min:0,step:.01,fullWidth:!0,error:!!g.errors.nonRenewableEnergy,helperText:g.errors.nonRenewableEnergy})}),e.jsx("div",{children:e.jsx(z,{label:"Population (in millions)",value:S,onChange:pe,placeholder:"Enter population value in millions",variant:"outlined",size:"medium",min:0,step:.01,fullWidth:!0,error:!!g.errors.population,helperText:g.errors.population})}),e.jsx("div",{children:e.jsx(z,{label:"Gross Domestic Product",value:Y,onChange:fe,placeholder:"Enter GDP value",variant:"outlined",size:"medium",min:0,step:.01,fullWidth:!0,error:!!g.errors.gdp,helperText:g.errors.gdp})})]})}),e.jsxs(de,{className:"p-4",children:[e.jsx(_,{variant:"secondary",onClick:y,className:"mr-2",children:"Cancel"}),e.jsx(_,{variant:"primary",onClick:ee,disabled:!g.isValid,className:"bg-red-500 hover:bg-red-600",children:s?"Update":"Save"})]})]}),e.jsxs(ne,{open:B&&!s,onClose:y,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(se,{className:"flex justify-between items-center",children:[e.jsx(J,{variant:"h6",children:"Add New Record"}),e.jsx(oe,{onClick:y,size:"small",children:e.jsx(he,{size:18})})]}),e.jsx(le,{children:e.jsxs(ie,{className:"p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Year"}),e.jsx(ce,{initialYear:m,onYearChange:c})]}),e.jsx("div",{children:e.jsx(z,{label:"Generation (GWh)",value:f,onChange:U,placeholder:"Enter generation value in GWh",variant:"outlined",size:"medium",min:0,step:.01,fullWidth:!0,error:!!g.errors.generation,helperText:g.errors.generation})})]})}),e.jsxs(de,{className:"p-4",children:[e.jsx(_,{variant:"secondary",onClick:y,className:"mr-2",children:"Cancel"}),e.jsx(_,{variant:"primary",onClick:ee,disabled:!g.isValid,className:"bg-yellow-500 hover:bg-yellow-600",children:"Save"})]})]})]})};export{ya as default};
