import{k as ee,b as se,r as h,Z as re,e as ie,l as ae,af as ne,j as e,o as v,B as t,T as r,a3 as W,J as le,E as b,U as oe,h as ce,s as de,g as G,ab as f,a8 as R,ah as xe}from"./index-CeiZKB8G.js";import{t as k}from"./ticketService-PgP5Vb-h.js";import{C as K}from"./Chip-D2qSxnvf.js";import{F as Q,S as V}from"./Select-CMa9xVQT.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],X=ee("ArrowLeft",he);/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],me=ee("Tag",ue),pe=n=>{const x=se(),{user:s,isAuthenticated:y}=h.useContext(re),o=ie(),i=ae(),[F,u]=h.useState(null),[A,w]=h.useState(!0),[g,N]=h.useState(""),[D,j]=h.useState(!1),[C,m]=h.useState(""),[T,S]=h.useState([]),[p,E]=h.useState("");return h.useEffect(()=>{y&&(s==null?void 0:s.role)!=="admin"&&(o.error("You do not have access to this page"),x("/"))},[y,s,x,o]),h.useEffect(()=>{const c=async()=>{w(!0),i&&typeof i.showLoader=="function"&&i.showLoader();try{const a=await k.getTicket(n);u(a.data.data||a.data),m(a.data.status||"open")}catch(a){console.error("Error fetching ticket:",a),o.error(a.message||"Failed to fetch ticket"),x("/admin/tickets")}finally{w(!1),i&&typeof i.hideLoader=="function"&&i.hideLoader()}},d=async()=>{try{const a=await k.getAdmins();S(a.data)}catch(a){console.error("Error fetching admins:",a)}};n&&(c(),d())},[n,x,o,i]),{ticket:F,loading:A,replyContent:g,setReplyContent:N,submitting:D,newStatus:C,admins:T,selectedAdmin:p,setSelectedAdmin:E,handleReply:async c=>{if(c.preventDefault(),!g.trim()){o.warning("Please enter a reply");return}j(!0),i&&typeof i.showLoader=="function"&&i.showLoader();try{const d=await k.replyToTicket(n,g);u(d.data),N(""),o.success("Reply sent successfully")}catch(d){console.error("Error replying to ticket:",d),o.error(d.message||"Failed to send reply")}finally{j(!1),i&&typeof i.hideLoader=="function"&&i.hideLoader()}},handleStatusChange:async c=>{const d=c.target.value;m(d),i&&typeof i.showLoader=="function"&&i.showLoader();try{const a=await k.updateTicketStatus(n,d);u(a.data),o.success(`Ticket status updated to ${d}`)}catch(a){console.error("Error updating ticket status:",a),o.error(a.message||"Failed to update ticket status"),m(F.status)}finally{i&&typeof i.hideLoader=="function"&&i.hideLoader()}},handleAssignTicket:async()=>{if(!p){o.warning("Please select an admin to assign");return}i&&typeof i.showLoader=="function"&&i.showLoader();try{const c=await k.assignTicket(n,p);u(c.data),o.success("Ticket assigned successfully")}catch(c){console.error("Error assigning ticket:",c),o.error(c.message||"Failed to assign ticket")}finally{i&&typeof i.hideLoader=="function"&&i.hideLoader()}}}},I=n=>{if(!n)return"N/A";try{const x=new Date(n);return isNaN(x.getTime())?(console.warn("Invalid date:",n),"Invalid Date"):new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(x)}catch(x){return console.error("Date formatting error:",x),"Invalid Date"}},fe=n=>{switch(n){case"open":return{bg:"#EEF7FF",color:"#1A73E8"};case"in-progress":return{bg:"#FFF7E0",color:"#F29D41"};case"resolved":return{bg:"#E7F7ED",color:"#34A853"};case"closed":return{bg:"#F2F2F2",color:"#5F6368"};default:return{bg:"#F2F2F2",color:"#5F6368"}}},ye=n=>{switch(n){case"low":return{bg:"#E7F7ED",color:"#34A853"};case"medium":return{bg:"#FFF7E0",color:"#F29D41"};case"high":return{bg:"#FFEBEE",color:"#E53935"};case"urgent":return{bg:"#7F1D1D",color:"#FFFFFF"};default:return{bg:"#F2F2F2",color:"#5F6368"}}},ke=()=>{var j,C,m,T,S,p,E,L,z,B,c,d,a,$,P,U,_,H,M,q,J,O,Y,Z;const{id:n}=ne(),x=se(),{ticket:s,replyContent:y,setReplyContent:o,submitting:i,newStatus:F,admins:u,selectedAdmin:A,setSelectedAdmin:w,handleReply:g,handleStatusChange:N,handleAssignTicket:D}=pe(n);return s?e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(le,{onClick:()=>x("/admin/tickets"),sx:{mr:2},children:e.jsx(X,{size:20})}),e.jsxs("div",{children:[e.jsxs(r,{variant:"h5",fontWeight:"bold",color:"text.primary",children:["Ticket #",s.ticketNumber]}),e.jsx(r,{variant:"body1",color:"text.secondary",children:s.subject})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsx("div",{className:"h-full",children:e.jsx(v.Base,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:e.jsxs(t,{sx:{p:3,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(r,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Ticket Details"}),e.jsx(b,{sx:{my:2}}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2,flex:1},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",width:100},children:[e.jsx(oe,{size:16,className:"mr-2"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Customer:"})]}),e.jsx(r,{variant:"body2",fontWeight:"medium",children:(j=s.user)!=null&&j.firstName&&((C=s.user)!=null&&C.lastName)?`${s.user.firstName} ${s.user.lastName}`:(m=s.user)==null?void 0:m.email})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",width:100},children:[e.jsx(me,{size:16,className:"mr-2"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Category:"})]}),e.jsx(r,{variant:"body2",fontWeight:"medium",sx:{textTransform:"capitalize"},children:s.category})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",width:100},children:[e.jsx(ce,{size:16,className:"mr-2"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Priority:"})]}),e.jsx(K,{label:s.priority,size:"small",sx:{...ye(s.priority),textTransform:"capitalize",fontWeight:"medium",fontSize:"0.75rem"}})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",width:100},children:[e.jsx(de,{size:16,className:"mr-2"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Status:"})]}),e.jsx(K,{label:(s.status||"unknown").replace("-"," "),size:"small",sx:{...fe(s.status||"unknown"),textTransform:"capitalize",fontWeight:"medium",fontSize:"0.75rem"}})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",width:100},children:[e.jsx(G,{size:16,className:"mr-2"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Created:"})]}),e.jsx(r,{variant:"body2",children:I(s.createdAt)})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",width:100},children:[e.jsx(G,{size:16,className:"mr-2"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Updated:"})]}),e.jsx(r,{variant:"body2",children:I(s.updatedAt)})]})]})]})})}),e.jsx("div",{className:"h-full",children:e.jsx(v.Base,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:e.jsxs(t,{sx:{p:3,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(r,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Ticket Actions"}),e.jsx(b,{sx:{my:2}}),e.jsxs(t,{sx:{mb:3},children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Update Status"}),e.jsx(Q,{fullWidth:!0,size:"small",children:e.jsxs(V,{value:F,onChange:N,displayEmpty:!0,children:[e.jsx(f,{value:"open",children:"Open"}),e.jsx(f,{value:"in-progress",children:"In Progress"}),e.jsx(f,{value:"resolved",children:"Resolved"}),e.jsx(f,{value:"closed",children:"Closed"})]})})]}),e.jsxs(t,{children:[e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Assign Ticket"}),e.jsxs(t,{sx:{display:"flex",gap:1},children:[e.jsx(Q,{fullWidth:!0,size:"small",children:e.jsxs(V,{value:A,onChange:l=>w(l.target.value),displayEmpty:!0,children:[e.jsx(f,{value:"",disabled:!0,children:s.assignedTo?`Currently: ${s.assignedTo.firstName} ${s.assignedTo.lastName}`:"Select Admin"}),u.map(l=>e.jsxs(f,{value:l._id,children:[l.firstName," ",l.lastName]},l._id))]})}),e.jsx(W,{onClick:D,disabled:!A,variant:"outlined",children:"Assign"})]})]})]})})}),e.jsx("div",{className:"h-full",children:e.jsx(v.Base,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:e.jsxs(t,{sx:{p:3,height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(r,{variant:"h6",fontWeight:"bold",gutterBottom:!0,children:"Customer Information"}),e.jsx(b,{sx:{my:2}}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(R,{src:(T=s.user)==null?void 0:T.profilePicture,sx:{width:64,height:64,mr:2},children:((p=(S=s.user)==null?void 0:S.firstName)==null?void 0:p.charAt(0))||((L=(E=s.user)==null?void 0:E.email)==null?void 0:L.charAt(0))}),e.jsxs(t,{children:[e.jsx(r,{variant:"subtitle1",fontWeight:"medium",children:(z=s.user)!=null&&z.firstName&&((B=s.user)!=null&&B.lastName)?`${s.user.firstName} ${s.user.lastName}`:(c=s.user)==null?void 0:c.email}),e.jsx(r,{variant:"body2",color:"text.secondary",children:(d=s.user)==null?void 0:d.email})]})]}),((a=s.user)==null?void 0:a.phone)&&e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(r,{variant:"body2",color:"text.secondary",sx:{width:100},children:"Phone:"}),e.jsx(r,{variant:"body2",children:s.user.phone})]})]})})})]}),e.jsx("div",{children:e.jsxs(v.Base,{children:[e.jsxs(t,{sx:{p:3},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:2,py:1,px:1,gap:1.5,borderRadius:1},children:[e.jsx(R,{src:(($=s.user)==null?void 0:$.avatar)||((P=s.user)==null?void 0:P.profilePicture),children:((_=(U=s.user)==null?void 0:U.firstName)==null?void 0:_.charAt(0))||((M=(H=s.user)==null?void 0:H.email)==null?void 0:M.charAt(0))}),e.jsxs(t,{children:[e.jsx(r,{variant:"subtitle1",fontWeight:"medium",children:(q=s.user)!=null&&q.firstName&&((J=s.user)!=null&&J.lastName)?`${s.user.firstName} ${s.user.lastName}`:(O=s.user)==null?void 0:O.email}),e.jsx(r,{variant:"caption",color:"text.secondary",children:I(s.createdAt)})]})]}),e.jsx(r,{variant:"body1",sx:{mt:2,whiteSpace:"pre-wrap"},children:((Z=(Y=s.messages)==null?void 0:Y[0])==null?void 0:Z.content)||"No description provided"})]}),e.jsx(b,{}),e.jsx(t,{sx:{maxHeight:"500px",overflow:"auto",p:3},children:s.messages&&s.messages.length>1?s.messages.slice(1).map((l,te)=>e.jsxs(t,{sx:{mb:3,p:2,borderRadius:2,backgroundColor:l.isAdmin?"#F0FDF4":"#F8F9FA"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",mb:1,py:.5,px:.5,gap:1.5},children:[e.jsx(R,{sx:{bgcolor:l.isAdmin?"#16A34A":"#6B7280"},children:l.isAdmin?"A":"U"}),e.jsxs(t,{children:[e.jsx(r,{variant:"subtitle2",fontWeight:"medium",children:l.isAdmin?"Support Agent":"Customer"}),e.jsx(r,{variant:"caption",color:"text.secondary",children:I(l.createdAt)})]})]}),e.jsx(r,{variant:"body2",sx:{mt:1,whiteSpace:"pre-wrap"},children:l.content})]},te)):e.jsx(r,{variant:"body2",color:"text.secondary",align:"center",children:"No replies yet"})}),e.jsx(b,{}),e.jsx(t,{sx:{p:3},children:e.jsxs("form",{onSubmit:g,children:[e.jsx(xe,{name:"replyContent",value:y,onChange:l=>o(l.target.value),placeholder:"Type your reply here...",rows:4,required:!0}),e.jsx(t,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:e.jsx(W,{type:"submit",loading:i,disabled:i||!y.trim(),children:"Send Reply"})})]})})]})})]}):e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsx(v.Error,{children:e.jsxs(t,{sx:{p:4,textAlign:"center"},children:[e.jsx(r,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"Ticket Not Found"}),e.jsx(r,{variant:"body1",paragraph:!0,children:"The ticket you're looking for doesn't exist or you don't have permission to view it."}),e.jsx(W,{onClick:()=>x("/admin/tickets"),startIcon:e.jsx(X,{size:18}),children:"Back to Tickets"})]})})})};export{ke as default};
