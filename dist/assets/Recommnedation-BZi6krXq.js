import{e as $,r as c,$ as G,a0 as H,c as O,a1 as U,j as t,a2 as E,n as k,a3 as V,V as R,a4 as X,T as x}from"./index-CeiZKB8G.js";import{S as J}from"./SingleYearPicker--w-JP6tS.js";import q from"./html2canvas.esm-CBrSDip1.js";import{s as K}from"./tup_logo-CddcVZx9.js";import{C as Q}from"./Chip-D2qSxnvf.js";import"./DatePicker-Ds6sJbAa.js";import"./index-D_GLsIW_.js";import"./useThemeProps-B7RzBULZ.js";import"./index-BGHELInD.js";import"./TextField-CJViWXc3.js";import"./Select-CMa9xVQT.js";import"./AdapterDayjs-J5u3snYC.js";import"./refresh-ccw-DYG20dKq.js";const T={cityData:{budget:"₱300000",year:"2025",location:{coordinates:"14.5176° N, 121.0509° E",solarPotential:"High",windPotential:"Moderate",hydroPotential:"Available (Nearby Rivers)"}},projections:[],costBenefits:[]},Z=()=>{const a=$(),[y,i]=c.useState(!0),[w,j]=c.useState(G(T.cityData.year)),[p,e]=c.useState(T.cityData),[d,S]=c.useState(T.projections),[o,l]=c.useState(T.costBenefits),[m,b]=c.useState(T.energyPotential);return c.useEffect(()=>{(async()=>{i(!0);try{await new Promise(P=>setTimeout(P,800)),i(!1)}catch(P){console.error("Error fetching data:",P),a.error("Failed to fetch recommendations data"),i(!1)}})()},[w]),{cityData:p,projections:d,costBenefits:o,energyPotential:m,handleDownloadPDF:()=>{try{i(!0),a.info("Preparing PDF download..."),setTimeout(()=>{i(!1),a.success("PDF downloaded successfully!")},2e3)}catch(u){console.error("Error downloading PDF:",u),a.error("Failed to download PDF"),i(!1)}},year:w,handleYearChange:u=>{!u||!u.isValid()||(j(u),e(P=>({...P,year:u.year().toString()})))},isLoading:y,setIsLoading:i}},ee=async(a,y,i)=>{var w,j,p;try{i.info("Preparing your PDF download...");const e=new H({orientation:"portrait",unit:"mm",format:"a4"}),d=e.internal.pageSize.getWidth(),S=e.internal.pageSize.getHeight(),o=15,l=d-o*2,m={primary:[22,163,74],secondary:[255,184,0],accent:[59,130,246],light:[249,250,251],dark:[31,41,55]},b=15,N=35;e.setFillColor(...m.primary),e.rect(0,0,d,N,"F");const g=20;e.addImage(O,"PNG",o,(N-g)/2,g,g),e.addImage(K,"PNG",d-o-g,(N-g)/2,g,g),e.setTextColor(255,255,255),e.setFontSize(18),e.setFont(void 0,"bold");const u="ENERGY RECOMMENDATIONS",P=e.getStringUnitWidth(u)*e.internal.getFontSize()/e.internal.scaleFactor,_=(d-P)/2;e.text(u,_,N/2+3),e.setFont(void 0,"normal"),e.setFontSize(9),e.setTextColor(255,255,255);const W=`Generated: ${new Date().toLocaleDateString()}`;e.text(W,d-o-2,N-5),e.setTextColor(0,0,0);let s=N+12;e.setFillColor(240,249,244),e.roundedRect(o,s,l,30,3,3,"F");const F=l/3;e.setDrawColor(...m.primary),e.setLineWidth(.5),e.line(o+F,s+5,o+F,s+25),e.line(o+F*2,s+5,o+F*2,s+25),e.setFont(void 0,"bold"),e.setFontSize(10),e.text("Budget",o+5,s+10),e.setFont(void 0,"normal"),e.setFontSize(12),e.text(`₱${a.budget.toLocaleString()}`,o+5,s+20),e.setFont(void 0,"bold"),e.setFontSize(10),e.text("Investment Year",o+F+5,s+10),e.setFont(void 0,"normal"),e.setFontSize(12),e.text(`${a.year}`,o+F+5,s+20),e.setFont(void 0,"bold"),e.setFontSize(10),e.text("Location",o+F*2+5,s+10),e.setFont(void 0,"normal"),e.setFontSize(12),e.text(`${a.location}`,o+F*2+5,s+20),s+=40,e.setFillColor(...m.primary),e.roundedRect(o,s,l,8,2,2,"F"),e.setFont(void 0,"bold"),e.setFontSize(11),e.setTextColor(255,255,255),e.text("RENEWABLE ENERGY POTENTIAL",o+5,s+5.5),e.setTextColor(0,0,0),s+=12,e.setFillColor(255,250,240),e.roundedRect(o,s,l,26,2,2,"F"),e.setFillColor(...m.secondary),e.circle(o+12,s+13,4,"F"),e.setFont(void 0,"bold"),e.setFontSize(11),e.text("Solar",o+25,s+10),e.setFont(void 0,"normal"),e.setFontSize(9),e.text(`Potential: ${a.solarPotential}`,o+25,s+18),e.text("Average 5.5 kWh/m²/day",o+25,s+24),s+=26+b,e.setFillColor(...m.accent),e.roundedRect(o,s,l,8,2,2,"F"),e.setFont(void 0,"bold"),e.setFontSize(11),e.setTextColor(255,255,255),e.text("FUTURE PROJECTIONS",o+5,s+5.5),e.setTextColor(0,0,0),s+=12;const z=[];if(a.futureProjections&&Object.entries(a.futureProjections).filter(([n])=>!["year","title"].includes(n)).forEach(([n,r])=>{z.push([n,r])}),a.futureProjections&&a.futureProjections.year&&a.futureProjections.title&&(e.setFillColor(240,249,255),e.roundedRect(o,s,l,12,2,2,"F"),e.setFontSize(10),e.setFont(void 0,"bold"),e.text(`${a.futureProjections.year}`,o+6,s+5),e.setFont(void 0,"normal"),e.text(`${a.futureProjections.title}`,o+30,s+8),s+=16),e.autoTable({head:[["Metric","Value"]],body:z,startY:s,theme:"grid",styles:{fontSize:9,cellPadding:4,lineColor:[220,220,220],lineWidth:.1},headStyles:{fillColor:m.accent,textColor:255,fontStyle:"bold"},columnStyles:{0:{cellWidth:110},1:{cellWidth:60,halign:"right"}},margin:{left:o,right:o},alternateRowStyles:{fillColor:[248,250,252]}}),s=e.autoTable.previous.finalY+b,s>S-100&&(e.addPage(),s=20),e.setFillColor(...m.secondary),e.roundedRect(o,s,l,8,2,2,"F"),e.setFont(void 0,"bold"),e.setFontSize(11),e.setTextColor(255,255,255),e.text("ESTIMATED YEARLY ENERGY PRODUCTION",o+5,s+5.5),e.setTextColor(0,0,0),s+=12,y&&y.chartRef&&y.chartRef.current)try{const n=y.chartRef.current,r=await q(n,{scale:2,useCORS:!0,logging:!1}),h=r.toDataURL("image/png"),v=Math.min(l,160),A=r.height/r.width,L=v*A,M=o+(l-v)/2;e.addImage(h,"PNG",M,s,v,L),s+=L+5}catch(n){console.error("Error capturing chart:",n),e.setFillColor(255,250,240),e.roundedRect(o,s,l,30,2,2,"F");const r=((j=(w=a.costBenefitAnalysis)==null?void 0:w.find(h=>{var v;return(v=h.label)==null?void 0:v.includes("Energy Production")}))==null?void 0:j.value)||"N/A";e.setFontSize(9),e.text("Total energy production per year",o+l/2,s+10,{align:"center"}),e.setFontSize(16),e.setFont(void 0,"bold"),e.text(r,o+l/2,s+22,{align:"center"}),e.setFont(void 0,"normal"),s+=35}s+=10,s>S-120&&(e.addPage(),s=20),e.setFillColor(...m.primary),e.roundedRect(o,s,l,8,2,2,"F"),e.setFont(void 0,"bold"),e.setFontSize(11),e.setTextColor(255,255,255),e.text("COST-BENEFIT ANALYSIS",o+5,s+5.5),e.setTextColor(0,0,0),s+=12;const f=((p=a.costBenefitAnalysis)==null?void 0:p.filter(n=>{var r;return!((r=n.label)!=null&&r.includes("Energy Production"))}))||[];if(f.length>0){const n=l/2-4;e.setFillColor(242,247,243),e.roundedRect(o,s,n,40,2,2,"F"),e.roundedRect(o+n+8,s,n,40,2,2,"F"),f[0]&&(e.setFontSize(10),e.setFont(void 0,"bold"),e.text(f[0].label,o+5,s+10),e.setFont(void 0,"normal"),e.setFontSize(14),e.setFont(void 0,"bold"),e.text(f[0].value,o+5,s+25),e.setFont(void 0,"normal")),f[1]&&(e.setFontSize(10),e.setFont(void 0,"bold"),e.text(f[1].label,o+n+13,s+10),e.setFont(void 0,"normal"),e.setFontSize(14),e.setFont(void 0,"bold"),e.text(f[1].value,o+n+13,s+25),e.setFont(void 0,"normal")),s+=40+b}else{const n=[];a.costBenefitAnalysis&&a.costBenefitAnalysis.forEach(r=>{n.push([r.label,r.value])}),e.autoTable({head:[["Metric","Value"]],body:n,startY:s,theme:"grid",styles:{fontSize:9,cellPadding:5,lineColor:[220,220,220],lineWidth:.1},headStyles:{fillColor:m.primary,textColor:255,fontStyle:"bold"},columnStyles:{0:{cellWidth:120},1:{cellWidth:50,halign:"right"}},margin:{left:o,right:o},alternateRowStyles:{fillColor:[248,250,252]}}),s=e.autoTable.previous.finalY+b}s>S-80&&(e.addPage(),s=20),e.setFillColor(...m.primary),e.roundedRect(o,s,l,8,2,2,"F"),e.setFont(void 0,"bold"),e.setFontSize(11),e.setTextColor(255,255,255),e.text("RECOMMENDATIONS",o+5,s+5.5),e.setTextColor(0,0,0),s+=12,e.setFillColor(242,247,243),e.roundedRect(o,s,l,42,2,2,"F"),e.setFontSize(9),e.setFont(void 0,"normal");const D=["Invest in solar panel infrastructure to capitalize on the projected growth trend.","Consider energy storage solutions to maximize return on investment.","Evaluate technological upgrades to improve solar capture efficiency.","Implement regular maintenance schedule to ensure optimal performance."];let C=s+8;D.forEach(n=>{e.setFillColor(...m.primary),e.circle(o+5,C,1.5,"F");const r=e.splitTextToSize(n,l-15);e.text(r,o+10,C),C+=10}),s=S-15,e.setDrawColor(...m.primary),e.setLineWidth(.5),e.line(o,s-5,d-o,s-5),e.setFontSize(8);const I=`© ${new Date().getFullYear()} Ecopulse. All rights reserved.`,Y=e.getStringUnitWidth(I)*e.internal.getFontSize()/e.internal.scaleFactor,B=(d-Y)/2;return e.text(I,B,s),e.addImage(O,"PNG",d-o-8,s-4,8,8),e.save("Energy_Recommendations.pdf"),i.success("PDF downloaded successfully!"),{success:!0}}catch(e){return console.error("Download error:",e),i.error("Failed to download PDF. Please try again."),{success:!1,error:e}}},ge=()=>{var Y,B;const a=$(),{cityData:y}=Z(),[i,w]=c.useState(null),[j,p]=c.useState(!1),[e,d]=c.useState(!0),S=c.useRef(null),o=c.useRef(null),[l,m]=c.useState("50000"),[b,N]=c.useState(new Date().getFullYear()+1),g=c.useRef(null),u=c.useCallback((n,r)=>{!n||!r||(g.current&&clearTimeout(g.current),p(!0),g.current=setTimeout(async()=>{try{const h=typeof n=="string"?parseInt(n,10):n,v=await U.get("/api/solar_recommendations",{params:{year:r,budget:h}});v.data&&v.data.recommendations?(o.current=i,w(v.data.recommendations)):(console.error("Invalid data format received:",v.data),a.error("Invalid data format received from the server"))}catch(h){console.error("Error fetching solar recommendations:",h),a.error(`Failed to fetch solar recommendations: ${h.message}`)}finally{p(!1),d(!1)}},300),setTimeout(()=>{p(!1),d(!1)},1e4))},[a,i]);c.useEffect(()=>{const n=parseInt(l,10);if(n>=15e3)try{u(n,b)}catch(r){console.error("Error during initial data load:",r),p(!1),d(!1)}else d(!1);return()=>{g.current&&clearTimeout(g.current),p(!1),d(!1)}},[u]);const P=n=>{const r=n.target.value;if(r===""||/^\d*$/.test(r)){m(r);const h=r===""?0:parseInt(r,10);h>=15e3&&u(h,b)}},_=n=>{N(n);const r=parseInt(l,10);r>=15e3&&u(r,n)},W=()=>{var n;return!i||!i.cost_benefit_analysis?j&&((n=o.current)!=null&&n.cost_benefit_analysis)?o.current.cost_benefit_analysis.filter(r=>r.label.includes("Energy Production")):[]:i.cost_benefit_analysis.filter(r=>r.label.includes("Energy Production"))},s=()=>{var n;return!i||!i.cost_benefit_analysis?j&&((n=o.current)!=null&&n.cost_benefit_analysis)?o.current.cost_benefit_analysis.filter(r=>!r.label.includes("Energy Production")):[]:i.cost_benefit_analysis.filter(r=>!r.label.includes("Energy Production"))},F=()=>{var n;return!i||!i.future_projections?j&&((n=o.current)!=null&&n.future_projections)?o.current.future_projections:null:i.future_projections},z=e&&j,f=F(),D=W(),C=s(),I=async()=>{var n;try{a.info("Preparing your PDF download...");const h={budget:parseInt(l,10),year:b,location:y.city,solarPotential:((n=y.location)==null?void 0:n.solarPotential)||"High",futureProjections:f,costBenefitAnalysis:[...D,...C]};if(!(await ee(h,{chartRef:S},a)).success)throw new Error("PDF generation failed")}catch(r){console.error("Error downloading PDF:",r),a.error("Failed to download PDF")}};return t.jsxs("div",{className:"bg-gray-50 min-h-screen",children:[t.jsx("div",{className:"bg-green-700 text-white shadow-md",children:t.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4 flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-semibold",children:"Energy Recommendations"}),t.jsxs("div",{className:"flex items-center text-green-100 text-sm",children:[t.jsx(E,{name:"location",size:16,className:"mr-1"}),t.jsxs("span",{children:[y.city," • ",y.period]})]})]}),t.jsxs("div",{className:"flex items-center",children:[j&&!e&&t.jsx(k,{size:20,className:"text-white mr-3"}),t.jsxs(V,{variant:"outlined",className:"text-white border-white hover:bg-green-800",onClick:I,children:[t.jsx(E,{name:"save",size:18,className:"mr-2"}),"Download PDF"]})]})]})}),t.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[t.jsx(R,{className:"mb-6 rounded-lg shadow-sm",children:t.jsxs("div",{className:"p-5 grid grid-cols-1 md:grid-cols-2 gap-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Budget"}),t.jsx(X,{placeholder:"Enter Budget",value:l,onChange:P,size:"medium",variant:"outlined",className:"w-full",prefix:"₱"}),t.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Minimum: ₱15,000"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Year"}),t.jsx(J,{initialYear:b,onYearChange:_,className:"w-full"})]})]})}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[t.jsxs("div",{children:[t.jsx(x,{variant:"h6",className:"font-semibold mb-3 text-gray-800",children:"Renewable Energy Potential"}),t.jsxs(R,{className:"rounded-lg shadow-sm overflow-hidden h-full",children:[t.jsx("div",{className:"bg-yellow-500 h-1"}),t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center mb-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-yellow-100 flex items-center justify-center mr-3",children:t.jsx(E,{name:"solar",size:20,className:"text-yellow-600"})}),t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium",children:"Solar"}),t.jsxs("p",{className:"text-sm text-gray-600",children:["Potential: ",((Y=y.location)==null?void 0:Y.solarPotential)||"High"]})]})]}),t.jsx("p",{className:"text-sm text-gray-500",children:"Average 5.5 kWh/m²/day"})]})]})]}),t.jsxs("div",{children:[t.jsx(x,{variant:"h6",className:"font-semibold mb-3 text-gray-800",children:"Future Projections"}),t.jsx(R,{className:"rounded-lg shadow-sm h-full",children:t.jsx("div",{className:"p-4",children:f?t.jsxs("div",{children:[t.jsxs("div",{className:"mb-2",children:[t.jsx(Q,{label:f.year,size:"small",className:"bg-blue-100 text-blue-700 mb-1 mr-2"}),t.jsx("span",{className:"font-medium",children:f.title})]}),t.jsx("div",{className:"relative h-2 bg-gray-200 rounded-full mb-3",children:t.jsx("div",{className:"absolute top-0 left-0 h-full bg-blue-500 rounded-full",style:{width:"75%"}})}),t.jsx("ul",{className:"text-sm text-gray-600 space-y-1",children:Object.entries(f).filter(([n])=>!["year","title"].includes(n)).map(([n,r],h)=>t.jsxs("li",{className:"flex",children:[t.jsx("span",{className:"h-2 w-2 mt-1.5 mr-2 rounded-full bg-blue-500 flex-shrink-0"}),t.jsxs("span",{children:[n,": ",r]})]},h))})]}):t.jsx("div",{className:"text-center py-4 text-gray-500",children:t.jsx("p",{children:"No projection data available"})})})})]})]}),t.jsx(x,{variant:"h6",className:"font-semibold mb-3 text-gray-800",children:"Estimated Yearly Energy Production"}),t.jsx("div",{ref:S,className:"mb-6",children:t.jsxs(R,{className:"rounded-lg shadow-sm overflow-hidden",children:[t.jsx("div",{className:"bg-yellow-500 h-1"}),t.jsxs("div",{className:"p-4",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-yellow-100 flex items-center justify-center mr-3",children:t.jsx(E,{name:"energy",size:20,className:"text-yellow-600"})}),t.jsxs("div",{children:[t.jsx(x,{variant:"subtitle1",className:"font-medium",children:"Estimated Yearly Energy Production"}),t.jsx(x,{variant:"body2",className:"text-gray-600",children:"Total energy production per year"})]})]}),t.jsx(x,{variant:"h4",className:"font-bold text-gray-800 mt-3 ml-3",children:D.length>0?(B=D[0])==null?void 0:B.value:"Calculating..."})]})]})}),t.jsx(x,{variant:"h6",className:"font-semibold mb-3 text-gray-800",children:"Cost-Benefit Analysis"}),t.jsxs(R,{className:"rounded-lg shadow-sm overflow-hidden mb-6",children:[t.jsx("div",{className:"bg-blue-500 h-1"}),t.jsx("div",{className:"p-4",children:t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[C.map((n,r)=>t.jsxs("div",{className:"p-3",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-100 flex items-center justify-center mr-2",children:t.jsx(E,{name:n.icon||"chart",size:16,className:"text-green-600"})}),t.jsx(x,{variant:"subtitle1",className:"font-medium",children:n.label})]}),t.jsx(x,{variant:"h4",className:"font-bold text-gray-800 mt-2 ml-2",children:n.value})]},`api-${r}`)),C.length===0&&!z&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"p-3",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-100 flex items-center justify-center mr-2",children:t.jsx(E,{name:"savings",size:16,className:"text-green-600"})}),t.jsx(x,{variant:"subtitle1",className:"font-medium",children:"Estimated Yearly Savings"})]}),t.jsx(x,{variant:"h4",className:"font-bold text-gray-800 mt-2 ml-2",children:"Calculating..."})]}),t.jsxs("div",{className:"p-3",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx("div",{className:"w-8 h-8 rounded-lg bg-green-100 flex items-center justify-center mr-2",children:t.jsx(E,{name:"roi",size:16,className:"text-green-600"})}),t.jsx(x,{variant:"subtitle1",className:"font-medium",children:"Estimated ROI (Payback Period)"})]}),t.jsx(x,{variant:"h4",className:"font-bold text-gray-800 mt-2 ml-2",children:"Calculating..."})]})]})]})})]})]}),z&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-20 flex items-center justify-center z-50",children:t.jsx(R,{className:"p-6 rounded-lg shadow-lg",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx(k,{size:24,className:"text-green-500"}),t.jsx(x,{children:"Loading initial data..."})]})})})]})};export{ge as default};
