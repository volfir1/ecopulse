import{k as w,o as R,u as A,b as S,e as I,r as c,j as e,q as T,t as q,s as C,i as h,f as y}from"./index-BN0NLy4X.js";import{X as E}from"./x-DDYGCXAs.js";/**
 * @license lucide-react v0.473.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],P=w("Loader",L),M=()=>{const[b]=R(),{setUser:i,setIsAuthenticated:u}=A(),d=S(),o=I(),[l,t]=c.useState("loading"),[v,p]=c.useState(""),[m,a]=c.useState(""),[g,f]=c.useState(null),s=b.get("token"),x=c.useRef(!1);c.useEffect(()=>{if(x.current)return;(async()=>{if(!s){t("error"),a("Invalid recovery link. No token provided.");return}x.current=!0,console.log(`Attempting account recovery with token: ${s.substring(0,5)}...`);try{const r=await y.recoverAccount(s);console.log("Recovery result:",r),r.success?(r.user&&(console.log("Received user data:",r.user),localStorage.setItem("user",JSON.stringify(r.user)),i(r.user),u(!0),r.user.accessToken&&localStorage.setItem("authToken",r.user.accessToken)),t("success"),p(r.message||"Your account has been successfully recovered!"),o.success("Account recovered successfully"),setTimeout(()=>{d("/dashboard")},3e3)):(t("error"),a(r.message||"Failed to recover account."),f(r.debug||null),o.error(r.message||"Failed to recover account"))}catch(r){console.error("Account recovery error:",r),t("error"),a(r.message||"An error occurred during account recovery."),o.error(r.message||"An error occurred during account recovery")}})()},[s,d,i,u,o]);const j=()=>{window.location.reload()},k=async()=>{const n=prompt("Please enter your email address to request a new recovery link:");if(n)try{t("loading");const r=await y.requestAccountRecovery(n);r.success?(o.success("A new recovery link has been sent to your email."),t("error"),a("A new recovery link has been sent to your email. Please check your inbox.")):(o.error(r.message||"Failed to send recovery email"),t("error"))}catch(r){console.error("Error requesting new token:",r),o.error(r.message||"Failed to send recovery email"),t("error")}};return e.jsx("div",{className:"min-h-screen bg-gray-50 flex flex-col items-center justify-center p-6",children:e.jsxs(T.Base,{className:"max-w-md w-full p-8",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("img",{src:"/logo.png",alt:"EcoPulse Logo",className:"w-16 h-16 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",style:{color:q.main},children:"Account Recovery"})]}),l==="loading"&&e.jsxs("div",{className:"flex flex-col items-center py-8",children:[e.jsx("div",{className:"mb-4",children:e.jsx(P,{className:"w-12 h-12 animate-spin text-green-600"})}),e.jsx("p",{className:"text-gray-600 text-center",children:"Processing your account recovery request..."}),s&&e.jsxs("p",{className:"text-xs text-gray-400 mt-4",children:["Token: ",s.substring(0,8),"...",s.substring(s.length-8)]})]}),l==="success"&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"mb-6 flex justify-center",children:e.jsx("div",{className:"rounded-full bg-green-100 p-4",children:e.jsx(C,{className:"w-12 h-12 text-green-600"})})}),e.jsx("h2",{className:"text-lg font-medium text-gray-800 mb-2",children:"Recovery Successful!"}),e.jsx("p",{className:"text-gray-600 mb-6",children:v}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"You will be redirected to your dashboard in a few seconds..."}),e.jsx(h,{to:"/dashboard",className:"block w-full py-2 px-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-center",children:"Go to Dashboard Now"})]}),l==="error"&&e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"mb-6 flex justify-center",children:e.jsx("div",{className:"rounded-full bg-red-100 p-4",children:e.jsx(E,{className:"w-12 h-12 text-red-600"})})}),e.jsx("h2",{className:"text-lg font-medium text-gray-800 mb-2",children:"Recovery Failed"}),e.jsx("p",{className:"text-red-500 mb-6",children:m}),s&&e.jsx("div",{className:"text-xs text-gray-500 mb-4 p-2 bg-gray-100 rounded-lg",children:e.jsxs("p",{children:["Recovery Token: ",s.substring(0,8),"...",s.substring(s.length-8)]})}),g&&e.jsx("div",{className:"text-xs text-left mb-4 p-2 bg-gray-100 rounded-lg overflow-auto max-h-32",children:e.jsx("pre",{children:JSON.stringify(g,null,2)})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:j,className:"block w-full py-2 px-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-center",children:"Retry Recovery"}),e.jsx("button",{onClick:k,className:"block w-full py-2 px-4 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors text-center",children:"Request New Recovery Link"}),e.jsx(h,{to:"/login",className:"block w-full py-2 px-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-center",children:"Return to Login"}),e.jsx("button",{onClick:()=>{const n="support@ecopulse.com",r="Account Recovery Issue",N=`I'm having an issue recovering my account.

Token: ${s}
Error: ${m}`;window.location.href=`mailto:${n}?subject=${encodeURIComponent(r)}&body=${encodeURIComponent(N)}`},className:"block w-full py-2 px-4 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-center",children:"Contact Support"})]})]})]})})};export{M as default};
