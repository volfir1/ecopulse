import{as as fe,ap as ve,a6 as pe,T as k,at as je,r as p,ar as Ue,j as e,an as ye,ao as we,au as C,B as f,P as de,a as F,O as W,I as H,av as Se,a4 as G,aw as te,ax as re,ay as ae,az as oe,C as be,J as Ce,a1 as De,f as ie,ac as Re,aA as Le,aB as Ae}from"./index-D-CDyacC.js";import{P as d}from"./index-CksT71-K.js";import{P as Z,C as ke}from"./People-CBjQFpaO.js";import{R as Te,a as Fe,X as ze,Y as Pe,T as Me,L as Ve}from"./generateCategoricalChart-D1B-xCeY.js";import{L as Ee,a as X}from"./LineChart-NES_vC5y.js";import{T as me,a as J}from"./Tabs-Crx7z2dm.js";import{T as Ie}from"./TableContainer-rSivYgFX.js";import{T as qe,a as We,b as _,c as U,d as He}from"./TableRow-AQbsE6lW.js";import{C as ne}from"./Chip-datRF1Xi.js";import{T as Ne}from"./TextField-GEjcJewa.js";import{u as N}from"./userService-C-OnijlG.js";import"./KeyboardArrowRight-DEGN5Fl8.js";import"./Select-BXcoeulH.js";function Oe(i){return ve("MuiDialogContentText",i)}fe("MuiDialogContentText",["root"]);const Be=i=>{const{classes:c}=i,w=we({root:["root"]},Oe,c);return{...c,...w}},$e=pe(k,{shouldForwardProp:i=>je(i)||i==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(i,c)=>c.root})({}),Q=p.forwardRef(function(c,y){const w=Ue({props:c,name:"MuiDialogContentText"}),{children:P,className:T,...R}=w,L=Be(R);return e.jsx($e,{component:"p",variant:"body1",color:"textSecondary",ref:y,ownerState:R,className:ye(L.root,T),...w,classes:L})}),le=C([e.jsx("path",{d:"M17 11c.34 0 .67.04 1 .09V6.27L10.5 3 3 6.27v4.91c0 4.54 3.2 8.79 7.5 9.82.55-.13 1.08-.32 1.6-.55-.69-.98-1.1-2.17-1.1-3.45 0-3.31 2.69-6 6-6"},"0"),e.jsx("path",{d:"M17 13c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 1.38c.62 0 1.12.51 1.12 1.12s-.51 1.12-1.12 1.12-1.12-.51-1.12-1.12.5-1.12 1.12-1.12m0 5.37c-.93 0-1.74-.46-2.24-1.17.05-.72 1.51-1.08 2.24-1.08s2.19.36 2.24 1.08c-.5.71-1.31 1.17-2.24 1.17"},"1")],"AdminPanelSettings"),Je=C(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2M4 12c0-4.42 3.58-8 8-8 1.85 0 3.55.63 4.9 1.69L5.69 16.9C4.63 15.55 4 13.85 4 12m8 8c-1.85 0-3.55-.63-4.9-1.69L18.31 7.1C19.37 8.45 20 10.15 20 12c0 4.42-3.58 8-8 8"}),"Block"),Ke=C(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),Ye=C(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever"),ce=C(e.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l4 4 4-4H6c0-3.86 3.14-7 7-7s7 3.14 7 7-3.14 7-7 7c-1.9 0-3.62-.76-4.88-1.99L6.7 18.42C8.32 20.01 10.55 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m2 8v-1c0-1.1-.9-2-2-2s-2 .9-2 2v1c-.55 0-1 .45-1 1v3c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-3c0-.55-.45-1-1-1m-1 0h-2v-1c0-.55.45-1 1-1s1 .45 1 1z"}),"LockReset"),Ge=C(e.jsx("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 14H4V8l8 5 8-5zm-8-7L4 6h16z"}),"MailOutline"),Xe=C(e.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert"),_e=C(e.jsx("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd"),Qe=C(e.jsx("path",{d:"M19 4h-3.5l-1-1h-5l-1 1H5v2h14zM6 7v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7zm8 7v4h-4v-4H8l4-4 4 4z"}),"RestoreFromTrash"),Ze=C(e.jsx("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp"),es=C(e.jsx("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm-2 16-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9z"}),"VerifiedUser"),O=({title:i,value:c,icon:y,color:w})=>e.jsx(be,{elevation:1,sx:{borderRadius:"10px"},children:e.jsx(Ce,{children:e.jsxs(f,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(f,{children:[e.jsx(k,{variant:"subtitle2",color:"textSecondary",sx:{mb:1},children:i}),e.jsx(k,{variant:"h3",component:"div",fontWeight:"bold",children:c})]}),e.jsx(De,{sx:{bgcolor:w,width:56,height:56},children:y})]})})}),ss=({data:i})=>{const c=i.statistics||{totalUsers:"0",activeUsers:"0",newUsers:"0",verifiedUsers:"0",deletedUsers:"0"},y=i.activityData&&i.activityData.length>0?i.activityData:[{date:"Feb 19",totalVisits:7,activeUsers:4,newUsers:2},{date:"Feb 20",totalVisits:5,activeUsers:3,newUsers:1},{date:"Feb 21",totalVisits:6,activeUsers:4,newUsers:0},{date:"Feb 22",totalVisits:6,activeUsers:3,newUsers:2},{date:"Feb 23",totalVisits:8,activeUsers:4,newUsers:1},{date:"Feb 24",totalVisits:10,activeUsers:4,newUsers:3},{date:"Feb 25",totalVisits:4,activeUsers:3,newUsers:0}];return e.jsxs(f,{sx:{mt:4},children:[e.jsx(k,{variant:"h6",sx:{mb:2},children:"User Dashboard"}),e.jsxs(f,{sx:{display:"flex",flexWrap:"wrap",gap:3,mb:4},children:[e.jsx(f,{sx:{flex:"1 1 200px"},children:e.jsx(O,{title:"Total Users",value:c.totalUsers,icon:e.jsx(Z,{fontSize:"medium",sx:{color:"white"}}),color:"#34a853"})}),e.jsx(f,{sx:{flex:"1 1 200px"},children:e.jsx(O,{title:"Active Users",value:c.activeUsers,icon:e.jsx(Ze,{fontSize:"medium",sx:{color:"white"}}),color:"#8bc34a"})}),e.jsx(f,{sx:{flex:"1 1 200px"},children:e.jsx(O,{title:"New Users",value:c.newUsers,icon:e.jsx(_e,{fontSize:"medium",sx:{color:"white"}}),color:"#2196f3"})}),e.jsx(f,{sx:{flex:"1 1 200px"},children:e.jsx(O,{title:"Verified Users",value:c.verifiedUsers,icon:e.jsx(es,{fontSize:"medium",sx:{color:"white"}}),color:"#ffc107"})}),e.jsx(f,{sx:{flex:"1 1 200px"},children:e.jsx(O,{title:"Deleted Users",value:c.deletedUsers,icon:e.jsx(Je,{fontSize:"medium",sx:{color:"white"}}),color:"#f44336"})})]}),e.jsxs(de,{elevation:1,sx:{p:3,borderRadius:"4px",border:"1px dashed #e0e0e0"},children:[e.jsx(k,{variant:"h6",sx:{mb:3},children:"User Activity"}),e.jsx(f,{sx:{height:300},children:e.jsx(Te,{width:"100%",height:"100%",children:e.jsxs(Ee,{data:y,margin:{top:10,right:30,left:0,bottom:10},children:[e.jsx(Fe,{strokeDasharray:"3 3",vertical:!1}),e.jsx(ze,{dataKey:"date"}),e.jsx(Pe,{}),e.jsx(Me,{}),e.jsx(Ve,{wrapperStyle:{position:"relative",marginTop:"10px"}}),e.jsx(X,{type:"monotone",dataKey:"totalVisits",name:"Total Visits",stroke:"#2196f3",strokeWidth:2,activeDot:{r:6}}),e.jsx(X,{type:"monotone",dataKey:"activeUsers",name:"Active Users",stroke:"#4caf50",strokeWidth:2}),e.jsx(X,{type:"monotone",dataKey:"newUsers",name:"New Users",stroke:"#ff9800",strokeWidth:2})]})})})]})]})},he=({users:i,deletedUsers:c,handleEdit:y,handleSoftDelete:w,handleRestore:P,handleSendRecovery:T,handleSendPasswordReset:R,updateUserRole:L})=>{const[z,M]=p.useState(null),[j,A]=p.useState(null),[v,V]=p.useState(!1),[l,t]=p.useState(""),[n,u]=p.useState({userId:null,userName:"",currentRole:"",newRole:"",confirmationPhrase:""}),[o,x]=p.useState({open:!1,title:"",message:"",confirmText:"",action:null}),[r,m]=p.useState(0),a=s=>{if(!s)return"Never";try{return new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(g){return console.error("Date formatting error:",g),"Invalid date"}},K=(s,g)=>{M(s.currentTarget),A(g)},E=()=>{M(null),A(null)},$=s=>{E();const g=s==="admin"?`make ${j.name} admin`:`remove admin from ${j.name}`;u({userId:j.id,userName:j.name,currentRole:j.role,newRole:s,confirmationPhrase:g}),V(!0)},h=()=>{V(!1),t("")},I=async()=>{if(l===n.confirmationPhrase)try{const s=await L(n.userId,n.newRole);s.success?h():console.error("Failed to update role:",s.error)}catch(s){console.error("Error updating user role:",s)}},S=(s,g)=>{x({open:!0,title:"Confirm User Deactivation",message:`Are you sure you want to deactivate the user "${g}"? This action can be reversed later.`,confirmText:"Deactivate",action:()=>w(s)})},D=(s,g)=>{x({open:!0,title:"Confirm User Restoration",message:`Are you sure you want to restore the user "${g}"?`,confirmText:"Restore",action:()=>P(s)})},b=(s,g)=>{x({open:!0,title:"Send Recovery Link",message:`Are you sure you want to send a recovery link to "${g}" (${s})?`,confirmText:"Send Recovery Link",action:()=>T(s)})},ee=(s,g)=>{x({open:!0,title:"Send Password Reset Link",message:`Are you sure you want to send a password reset link to "${g}" (${s})?`,confirmText:"Send Reset Link",action:()=>R(s)})},ue=async()=>{o.action&&await o.action(),x({...o,open:!1})},xe=(s,g)=>{m(g)},[q,Y]=p.useState("all"),ge=q==="all"?i:i.filter(s=>s.role===q),se=r===0?ge:c;return e.jsxs(f,{sx:{mt:2},children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(k,{variant:"h6",children:"Users Management"}),r===0&&e.jsxs(f,{children:[e.jsx(F,{variant:q==="all"?"contained":"outlined",size:"small",onClick:()=>Y("all"),sx:{mr:1},children:"All Users"}),e.jsxs(F,{variant:q==="admin"?"contained":"outlined",size:"small",onClick:()=>Y("admin"),sx:{mr:1},color:"primary",children:[e.jsx(le,{sx:{mr:.5,fontSize:18}}),"Admins"]}),e.jsxs(F,{variant:q==="user"?"contained":"outlined",size:"small",onClick:()=>Y("user"),color:"info",children:[e.jsx(Z,{sx:{mr:.5,fontSize:18}}),"Regular Users"]})]})]}),e.jsx(f,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(me,{value:r,onChange:xe,TabIndicatorProps:{style:{height:"3px",backgroundColor:r===0?"#1b5e20":"#d32f2f"}},children:[e.jsx(J,{label:"Active Users",icon:e.jsx(ke,{}),iconPosition:"start",sx:{fontWeight:r===0?"bold":"normal",color:r===0?"#1b5e20":"inherit"}}),e.jsx(J,{label:"Deleted Users",icon:e.jsx(Ye,{}),iconPosition:"start",sx:{fontWeight:r===1?"bold":"normal",color:r===1?"#d32f2f":"inherit"}})]})}),e.jsx(Ie,{component:de,elevation:0,sx:{border:"1px solid #e0e0e0"},children:e.jsxs(qe,{children:[e.jsx(We,{sx:{backgroundColor:r===0?"#f5f5f5":"#ffebee"},children:e.jsxs(_,{children:[e.jsx(U,{children:"Name"}),e.jsx(U,{children:"Email"}),e.jsx(U,{children:"Role"}),e.jsx(U,{children:"Status"}),r===1&&e.jsx(U,{children:"Deleted At"}),e.jsx(U,{children:r===0?"Last Active":"Created At"}),e.jsx(U,{align:"right",children:"Actions"})]})}),e.jsxs(He,{children:[se.map(s=>e.jsxs(_,{sx:{"&:last-child td, &:last-child th":{border:0},bgcolor:r===0&&s.role==="admin"?"rgba(27, 94, 32, 0.04)":r===1?"rgba(211, 47, 47, 0.04)":"transparent"},children:[e.jsx(U,{children:s.name}),e.jsx(U,{children:s.email}),e.jsx(U,{children:e.jsx(ne,{label:s.role,color:s.role==="admin"?"primary":"default",size:"small",sx:{bgcolor:s.role==="admin"?"#1b5e20":"transparent",color:s.role==="admin"?"white":"inherit",fontWeight:500}})}),e.jsx(U,{children:e.jsx(ne,{label:s.status,color:s.status==="active"?"success":s.status==="deleted"?"error":"warning",size:"small",sx:{bgcolor:s.status==="active"?"#4caf50":s.status==="deleted"?"#d32f2f":"#ff9800",color:"white",fontWeight:500}})}),r===1&&e.jsx(U,{children:a(s.deletedAt)}),e.jsx(U,{children:a(r===0?s.lastActive:s.createdAt)}),e.jsx(U,{align:"right",children:r===0?e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Send Password Reset Link",children:e.jsx(H,{size:"small",onClick:()=>ee(s.email,s.name),color:"primary",sx:{mr:1},children:e.jsx(ce,{fontSize:"small"})})}),e.jsx(W,{title:"Deactivate User",children:e.jsx(H,{size:"small",onClick:()=>S(s.id,s.name),color:"error",sx:{mr:1},children:e.jsx(Ke,{fontSize:"small"})})}),e.jsx(W,{title:"More actions",children:e.jsx(H,{size:"small",onClick:g=>K(g,s),children:e.jsx(Xe,{fontSize:"small"})})})]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{title:"Send Recovery Link",children:e.jsx(H,{size:"small",onClick:()=>b(s.email,s.name),color:"warning",sx:{mr:1},children:e.jsx(Ge,{fontSize:"small"})})}),e.jsx(W,{title:"Restore User",children:e.jsx(H,{size:"small",onClick:()=>D(s.id,s.name),color:"primary",sx:{mr:1},children:e.jsx(Qe,{fontSize:"small"})})})]})})]},s.id)),se.length===0&&e.jsx(_,{children:e.jsx(U,{colSpan:r===0?6:7,align:"center",sx:{py:3},children:e.jsx(k,{variant:"body1",color:"textSecondary",children:r===0?"No active users found":"No deleted users found"})})})]})]})}),e.jsxs(Se,{anchorEl:z,open:!!z,onClose:E,children:[j&&j.role!=="admin"&&e.jsxs(G,{onClick:()=>$("admin"),children:[e.jsx(le,{fontSize:"small",sx:{mr:1}}),"Make Admin"]}),j&&j.role==="admin"&&e.jsxs(G,{onClick:()=>$("user"),children:[e.jsx(Z,{fontSize:"small",sx:{mr:1}}),"Remove Admin Privileges"]}),j&&e.jsxs(G,{onClick:()=>{E(),ee(j.email,j.name)},children:[e.jsx(ce,{fontSize:"small",sx:{mr:1}}),"Send Password Reset"]})]}),e.jsxs(te,{open:v,onClose:h,children:[e.jsx(re,{children:n.newRole==="admin"?"Grant Admin Privileges":"Remove Admin Privileges"}),e.jsxs(ae,{children:[e.jsx(Q,{sx:{mb:2},children:n.newRole==="admin"?`You are about to grant admin privileges to ${n.userName}. This will give them full access to manage users and system settings.`:`You are about to remove admin privileges from ${n.userName}.`}),e.jsxs(Q,{sx:{mb:2,fontWeight:"bold"},children:["To confirm, please type: ",e.jsx("span",{style:{color:"#1b5e20"},children:n.confirmationPhrase})]}),e.jsx(Ne,{autoFocus:!0,fullWidth:!0,value:l,onChange:s=>t(s.target.value),error:l!==""&&l!==n.confirmationPhrase,helperText:l!==""&&l!==n.confirmationPhrase?"Text doesn't match":null})]}),e.jsxs(oe,{children:[e.jsx(F,{onClick:h,children:"Cancel"}),e.jsx(F,{onClick:I,color:"primary",variant:"contained",disabled:l!==n.confirmationPhrase,children:"Confirm"})]})]}),e.jsxs(te,{open:o.open,onClose:()=>x({...o,open:!1}),children:[e.jsx(re,{children:o.title}),e.jsx(ae,{children:e.jsx(Q,{children:o.message})}),e.jsxs(oe,{children:[e.jsx(F,{onClick:()=>x({...o,open:!1}),children:"Cancel"}),e.jsx(F,{variant:"contained",color:o.confirmText==="Deactivate"?"error":o.confirmText==="Send Recovery Link"?"warning":"primary",onClick:ue,children:o.confirmText})]})]})]})};he.propTypes={users:d.arrayOf(d.shape({id:d.string.isRequired,name:d.string.isRequired,email:d.string.isRequired,role:d.string.isRequired,status:d.string.isRequired,lastActive:d.string})).isRequired,deletedUsers:d.arrayOf(d.shape({id:d.string.isRequired,name:d.string.isRequired,email:d.string.isRequired,role:d.string.isRequired,status:d.string.isRequired,deletedAt:d.string,createdAt:d.string})),handleEdit:d.func,handleSoftDelete:d.func.isRequired,handleRestore:d.func.isRequired,handleSendRecovery:d.func.isRequired,handleSendPasswordReset:d.func.isRequired,updateUserRole:d.func.isRequired};const B={statistics:{totalUsers:"9",activeUsers:"4",newUsers:"9",verifiedUsers:"0"},usersList:[{id:1,name:"John leonard",email:"leonard@gmail.com",role:"user",status:"inactive",lastActive:"2/26/2025"},{id:2,name:"user 1",email:"user@gmail.com",role:"user",status:"active",lastActive:"2/26/2025"},{id:3,name:"Lester Sible",email:"lesterpulansible@gmail.com",role:"admin",status:"active",lastActive:"2/26/2025"},{id:4,name:"name1 name2",email:"name@gmail.com",role:"user",status:"inactive",lastActive:"2/25/2025"},{id:5,name:"John a",email:"admin@123.com",role:"admin",status:"active",lastActive:"2/26/2025"},{id:6,name:"John Martins",email:"john1@gmail.com",role:"user",status:"inactive",lastActive:"2/25/2025"},{id:7,name:"John Martin",email:"john@gmail.com",role:"admin",status:"active",lastActive:"2/26/2025"},{id:8,name:"Lester Sible",email:"admin@gmail.com",role:"admin",status:"inactive",lastActive:"2/25/2025"}],activityData:[{date:"Feb 19",totalVisits:7,activeUsers:4,newUsers:2},{date:"Feb 20",totalVisits:5,activeUsers:3,newUsers:1},{date:"Feb 21",totalVisits:6,activeUsers:4,newUsers:0},{date:"Feb 22",totalVisits:6,activeUsers:3,newUsers:2},{date:"Feb 23",totalVisits:8,activeUsers:4,newUsers:1},{date:"Feb 24",totalVisits:10,activeUsers:4,newUsers:3},{date:"Feb 25",totalVisits:4,activeUsers:3,newUsers:0}],roles:["user","admin"],statuses:["active","inactive"]},ts=()=>{const[i,c]=p.useState({usersList:[],deletedUsers:[],statistics:{totalUsers:"0",activeUsers:"0",newUsers:"0",verifiedUsers:"0",deletedUsers:"0"},activityData:[]}),[y,w]=p.useState(!0),[P,T]=p.useState(null),[R,L]=p.useState(0),z=()=>{L(l=>l+1)};return p.useEffect(()=>{(async()=>{try{w(!0);let t=[],n=[],u={},o=[];try{const r=await N.getAllUsers();t=r.users||[];const a=(await N.getAllUsersWithDeleted()).users||[];n=a.filter(h=>h.isDeactivated);const K=t.filter(h=>h.lastLogin).length,E=t.filter(h=>{const I=new Date(h.createdAt),S=new Date,D=new Date(S.setDate(S.getDate()-30));return I>=D}).length,$=t.filter(h=>h.isVerified).length;if(u={totalUsers:t.length.toLocaleString(),activeUsers:K.toLocaleString(),newUsers:E.toLocaleString(),verifiedUsers:$.toLocaleString(),deletedUsers:n.length.toLocaleString()},a.length>0){const h={},I=new Date;for(let S=6;S>=0;S--){const D=new Date(I);D.setDate(D.getDate()-S);const b=D.toLocaleDateString("en-US",{month:"short",day:"numeric"});h[b]={date:b,totalVisits:0,activeUsers:0,newUsers:0}}a.forEach(S=>{if(S.lastLogin){const b=new Date(S.lastLogin).toLocaleDateString("en-US",{month:"short",day:"numeric"});h[b]&&(h[b].totalVisits++,h[b].activeUsers++)}if(S.createdAt){const b=new Date(S.createdAt).toLocaleDateString("en-US",{month:"short",day:"numeric"});h[b]&&h[b].newUsers++}}),o=Object.values(h)}else o=r.userActivity||B.activityData}catch(r){console.warn("API fetch failed, using mock data:",r),t=B.usersList,u=B.statistics,o=B.activityData}const x=(r,m=!1)=>r.map(a=>({id:a._id||a.id,name:a.name||`${a.firstName||""} ${a.lastName||""}`.trim(),email:a.email,role:a.role,status:m?"deleted":a.status||(a.lastLogin?"active":"inactive"),lastActive:a.lastActive||a.lastLogin||a.updatedAt||new Date,isDeactivated:m,createdAt:a.createdAt,deletedAt:a.updatedAt}));c({usersList:x(t),deletedUsers:x(n,!0),statistics:u,activityData:o})}catch(t){console.error("Failed to process users data:",t),c(B)}finally{w(!1)}})()},[R]),{data:i,setData:c,loading:y,selectedUser:P,setSelectedUser:T,handleSoftDeleteUser:async l=>{try{const t=await N.softDeleteUser(l);if(t.success){const n=i.usersList.find(u=>u.id===l);if(n){const u={...n,status:"deleted",isDeactivated:!0,deletedAt:new Date().toISOString()};c(o=>({...o,usersList:o.usersList.filter(x=>x.id!==l),deletedUsers:[...o.deletedUsers,u],statistics:{...o.statistics,totalUsers:(parseInt(o.statistics.totalUsers.replace(/,/g,""),10)-1).toLocaleString(),deletedUsers:(parseInt(o.statistics.deletedUsers.replace(/,/g,""),10)+1).toLocaleString()}}))}return{success:!0,message:"User successfully deactivated"}}else throw new Error(t.message||"Failed to deactivate user")}catch(t){return console.error("Failed to deactivate user:",t),{success:!1,error:{message:t.message||"Failed to deactivate user"}}}},handleRestoreUser:async l=>{try{const t=await N.restoreUser(l);if(t.success){const n=i.deletedUsers.find(u=>u.id===l);if(n){const u={...n,status:"active",isDeactivated:!1,lastActive:new Date().toISOString()};c(o=>({...o,deletedUsers:o.deletedUsers.filter(x=>x.id!==l),usersList:[...o.usersList,u],statistics:{...o.statistics,totalUsers:(parseInt(o.statistics.totalUsers.replace(/,/g,""),10)+1).toLocaleString(),deletedUsers:(parseInt(o.statistics.deletedUsers.replace(/,/g,""),10)-1).toLocaleString()}}))}return{success:!0,message:"User successfully restored"}}else throw new Error(t.message||"Failed to restore user")}catch(t){return console.error("Failed to restore user:",t),{success:!1,error:{message:t.message||"Failed to restore user"}}}},handleSendRecoveryLink:async l=>{try{const t=await ie.requestAccountRecovery(l);if(t.success)return{success:!0,message:"Recovery link sent successfully"};throw new Error(t.message||"Failed to send recovery link")}catch(t){return console.error("Failed to send recovery link:",t),{success:!1,error:{message:t.message||"Failed to send recovery link"}}}},handleSendPasswordResetLink:async l=>{try{const t=await ie.forgotPassword(l);if(t.success)return{success:!0,message:"Password reset link sent successfully"};throw new Error(t.message||"Failed to send password reset link")}catch(t){return console.error("Failed to send password reset link:",t),{success:!1,error:{message:t.message||"Failed to send password reset link"}}}},updateUserRole:async(l,t)=>{try{const n=await N.updateUserRole(l,t);if(n.success)return c(u=>({...u,usersList:u.usersList.map(o=>o.id===l?{...o,role:t,lastActive:new Date().toISOString()}:o)})),{success:!0,message:n.message};throw new Error(n.message||"Failed to update role")}catch(n){return console.error("Error updating user role:",n),{success:!1,error:{message:n.message||"Failed to update user role"}}}},refreshData:z}};function fs(){const[i,c]=p.useState(0),{data:y,loading:w,selectedUser:P,setSelectedUser:T,handleSoftDeleteUser:R,handleRestoreUser:L,handleSendRecoveryLink:z,handleSendPasswordResetLink:M,updateUserRole:j}=ts(),[A,v]=p.useState({open:!1,message:"",severity:"success"}),V=(r,m)=>{c(m)},l=r=>{console.log("Edit user:",r),T(r)},t=async r=>{var m;try{const a=await R(r);a.success?v({open:!0,message:"User has been successfully deactivated",severity:"success"}):v({open:!0,message:((m=a.error)==null?void 0:m.message)||"Failed to deactivate user",severity:"error"})}catch{v({open:!0,message:"An error occurred while deactivating the user",severity:"error"})}},n=async r=>{var m;try{const a=await L(r);a.success?v({open:!0,message:"User has been successfully restored",severity:"success"}):v({open:!0,message:((m=a.error)==null?void 0:m.message)||"Failed to restore user",severity:"error"})}catch{v({open:!0,message:"An error occurred while restoring the user",severity:"error"})}},u=async r=>{var m;try{const a=await z(r);a.success?v({open:!0,message:"Recovery link has been sent to the user",severity:"success"}):v({open:!0,message:((m=a.error)==null?void 0:m.message)||"Failed to send recovery link",severity:"error"})}catch{v({open:!0,message:"An error occurred while sending recovery link",severity:"error"})}},o=async r=>{var m;try{const a=await M(r);a.success?v({open:!0,message:"Password reset link has been sent to the user",severity:"success"}):v({open:!0,message:((m=a.error)==null?void 0:m.message)||"Failed to send password reset link",severity:"error"})}catch{v({open:!0,message:"An error occurred while sending password reset link",severity:"error"})}},x=()=>{v({...A,open:!1})};return w?e.jsx(f,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"300px"},children:e.jsx(Re,{})}):e.jsxs(f,{sx:{p:3,maxWidth:"100%"},children:[e.jsx(k,{variant:"h5",component:"h1",fontWeight:"medium",sx:{mb:2},children:"User Management"}),e.jsx(f,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(me,{value:i,onChange:V,TabIndicatorProps:{style:{height:"3px",backgroundColor:"#1b5e20"}},children:[e.jsx(J,{label:"DASHBOARD",sx:{fontWeight:i===0?"bold":"normal",color:i===0?"#1b5e20":"inherit"}}),e.jsx(J,{label:"USERS LIST",sx:{fontWeight:i===1?"bold":"normal",color:i===1?"#1b5e20":"inherit"}})]})}),i===0&&e.jsx(ss,{data:y}),i===1&&e.jsx(he,{users:y.usersList,deletedUsers:y.deletedUsers,handleEdit:l,handleSoftDelete:t,handleRestore:n,handleSendRecovery:u,handleSendPasswordReset:o,updateUserRole:j}),e.jsx(Le,{open:A.open,autoHideDuration:6e3,onClose:x,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(Ae,{onClose:x,severity:A.severity,variant:"filled",sx:{width:"100%"},children:A.message})})]})}export{fs as default};
