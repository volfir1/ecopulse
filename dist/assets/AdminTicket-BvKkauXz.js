import{r as p,ap as oe,ao as ie,aq as ne,bo as Y,aj as G,ag as ee,j as e,aP as u,ar as le,aV as ce,aW as de,b as ge,Z as pe,e as ue,T as v,o as y,B as j,a2 as me,a8 as J}from"./index-CeiZKB8G.js";import{t as Q}from"./ticketService-PgP5Vb-h.js";import{D as he}from"./DataTable-wS0beIS8.js";import{T as fe,a as C}from"./Tabs-DKAoBmDF.js";import{C as f}from"./Chip-D2qSxnvf.js";import"./TextField-CJViWXc3.js";import"./Select-CMa9xVQT.js";import"./refresh-ccw-DYG20dKq.js";import"./download-DBO_fhAY.js";import"./TablePagination-CbCjEsJh.js";import"./KeyboardArrowRight-Bas1HYWb.js";import"./TableRow-DpNBZInR.js";import"./SwitchBase-BXTMIM8-.js";import"./chevron-up-BJCzFM4M.js";const re=t=>{const r=p.useRef({});return p.useEffect(()=>{r.current=t}),r.current};function be(t){const{badgeContent:r,invisible:n=!1,max:d=99,showZero:b=!1}=t,F=re({badgeContent:r,max:d});let l=n;n===!1&&r===0&&!b&&(l=!0);const{badgeContent:g,max:c=d}=l?F:t,z=g&&Number(g)>c?`${c}+`:g;return{badgeContent:g,invisible:l,max:c,displayValue:z}}function xe(t){return ie("MuiBadge",t)}const T=oe("MuiBadge",["root","badge","dot","standard","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft","invisible","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","overlapRectangular","overlapCircular","anchorOriginTopLeftCircular","anchorOriginTopLeftRectangular","anchorOriginTopRightCircular","anchorOriginTopRightRectangular","anchorOriginBottomLeftCircular","anchorOriginBottomLeftRectangular","anchorOriginBottomRightCircular","anchorOriginBottomRightRectangular"]),L=10,_=4,ve=t=>{const{color:r,anchorOrigin:n,invisible:d,overlap:b,variant:F,classes:l={}}=t,g={root:["root"],badge:["badge",F,d&&"invisible",`anchorOrigin${u(n.vertical)}${u(n.horizontal)}`,`anchorOrigin${u(n.vertical)}${u(n.horizontal)}${u(b)}`,`overlap${u(b)}`,r!=="default"&&`color${u(r)}`]};return le(g,xe,l)},ye=ee("span",{name:"MuiBadge",slot:"Root",overridesResolver:(t,r)=>r.root})({position:"relative",display:"inline-flex",verticalAlign:"middle",flexShrink:0}),je=ee("span",{name:"MuiBadge",slot:"Badge",overridesResolver:(t,r)=>{const{ownerState:n}=t;return[r.badge,r[n.variant],r[`anchorOrigin${u(n.anchorOrigin.vertical)}${u(n.anchorOrigin.horizontal)}${u(n.overlap)}`],n.color!=="default"&&r[`color${u(n.color)}`],n.invisible&&r.invisible]}})(ce(({theme:t})=>({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignContent:"center",alignItems:"center",position:"absolute",boxSizing:"border-box",fontFamily:t.typography.fontFamily,fontWeight:t.typography.fontWeightMedium,fontSize:t.typography.pxToRem(12),minWidth:L*2,lineHeight:1,padding:"0 6px",height:L*2,borderRadius:L,zIndex:1,transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.enteringScreen}),variants:[...Object.entries(t.palette).filter(de(["contrastText"])).map(([r])=>({props:{color:r},style:{backgroundColor:(t.vars||t).palette[r].main,color:(t.vars||t).palette[r].contrastText}})),{props:{variant:"dot"},style:{borderRadius:_,height:_*2,minWidth:_*2,padding:0}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular",style:{top:0,right:0,transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${T.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="rectangular",style:{bottom:0,right:0,transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${T.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular",style:{top:0,left:0,transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${T.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="rectangular",style:{bottom:0,left:0,transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${T.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular",style:{top:"14%",right:"14%",transform:"scale(1) translate(50%, -50%)",transformOrigin:"100% 0%",[`&.${T.invisible}`]:{transform:"scale(0) translate(50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="right"&&r.overlap==="circular",style:{bottom:"14%",right:"14%",transform:"scale(1) translate(50%, 50%)",transformOrigin:"100% 100%",[`&.${T.invisible}`]:{transform:"scale(0) translate(50%, 50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="top"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular",style:{top:"14%",left:"14%",transform:"scale(1) translate(-50%, -50%)",transformOrigin:"0% 0%",[`&.${T.invisible}`]:{transform:"scale(0) translate(-50%, -50%)"}}},{props:({ownerState:r})=>r.anchorOrigin.vertical==="bottom"&&r.anchorOrigin.horizontal==="left"&&r.overlap==="circular",style:{bottom:"14%",left:"14%",transform:"scale(1) translate(-50%, 50%)",transformOrigin:"0% 100%",[`&.${T.invisible}`]:{transform:"scale(0) translate(-50%, 50%)"}}},{props:{invisible:!0},style:{transition:t.transitions.create("transform",{easing:t.transitions.easing.easeInOut,duration:t.transitions.duration.leavingScreen})}}]})));function X(t){return{vertical:(t==null?void 0:t.vertical)??"top",horizontal:(t==null?void 0:t.horizontal)??"right"}}const Te=p.forwardRef(function(r,n){const d=ne({props:r,name:"MuiBadge"}),{anchorOrigin:b,className:F,classes:l,component:g,components:c={},componentsProps:z={},children:P,overlap:O="rectangular",color:k="default",invisible:D=!1,max:U=99,badgeContent:S,slots:m,slotProps:x,showZero:A=!1,variant:R="standard",...W}=d,{badgeContent:a,invisible:o,max:s,displayValue:h}=be({max:U,invisible:D,badgeContent:S,showZero:A}),i=re({anchorOrigin:X(b),color:k,overlap:O,variant:R,badgeContent:S}),B=o||a==null&&R!=="dot",{color:$=k,overlap:w=O,anchorOrigin:E,variant:N=R}=B?i:d,ae=X(E),K=N!=="dot"?h:void 0,M={...d,badgeContent:a,invisible:B,max:s,displayValue:K,showZero:A,anchorOrigin:ae,color:$,overlap:w,variant:N},H=ve(M),Z=(m==null?void 0:m.root)??c.Root??ye,q=(m==null?void 0:m.badge)??c.Badge??je,I=(x==null?void 0:x.root)??z.root,V=(x==null?void 0:x.badge)??z.badge,se=Y({elementType:Z,externalSlotProps:I,externalForwardedProps:W,additionalProps:{ref:n,as:g},ownerState:M,className:G(I==null?void 0:I.className,H.root,F)}),te=Y({elementType:q,externalSlotProps:V,ownerState:M,className:G(H.badge,V==null?void 0:V.className)});return e.jsxs(Z,{...se,children:[P,e.jsx(q,{...te,children:K})]})}),Ee=()=>{const[t,r]=p.useState([]),[n,d]=p.useState(!0),[b,F]=p.useState(0),[l,g]=p.useState({total:0,open:0,inProgress:0,resolved:0,closed:0,unassigned:0}),[c,z]=p.useState({status:"",category:"",assigned:""}),P=ge(),{user:O,isAuthenticated:k}=p.useContext(pe),D=ue();p.useEffect(()=>{k&&(O==null?void 0:O.role)!=="admin"&&(D.error("You do not have access to this page"),P("/"))},[k,O,P,D]);const U=async()=>{d(!0);try{const a={};c.status&&(a.status=c.status),c.category&&(a.category=c.category),c.assigned&&(a.assigned=c.assigned);const s=(await Q.getAllTickets(a)).data.map(i=>{var B,$,w,E,N;return{...i,_userData:i.user,_assignedData:i.assignedTo,user:typeof i.user=="object"?(B=i.user)!=null&&B.firstName&&(($=i.user)!=null&&$.lastName)?`${i.user.firstName} ${i.user.lastName}`:((w=i.user)==null?void 0:w.email)||"Unknown User":i.user||"Unknown User",assignedTo:typeof i.assignedTo=="object"?(E=i.assignedTo)!=null&&E.firstName&&((N=i.assignedTo)!=null&&N.lastName)?`${i.assignedTo.firstName} ${i.assignedTo.lastName}`:"Unnamed Admin":null,status:String(i.status||"unknown"),priority:String(i.priority||"unknown")}});r(s);const h={total:s.length,open:s.filter(i=>i.status==="open").length,inProgress:s.filter(i=>i.status==="in-progress").length,resolved:s.filter(i=>i.status==="resolved").length,closed:s.filter(i=>i.status==="closed").length,unassigned:s.filter(i=>!i._assignedData).length};g(h)}catch(a){console.error("Error fetching tickets:",a),D.error(a.message||"Failed to fetch tickets")}finally{d(!1)}};p.useEffect(()=>{U(),(async()=>{try{const o=await Q.getTicketStats();o.data&&g(s=>({...s,...o.data}))}catch(o){console.error("Error fetching ticket stats:",o)}})()},[c]);const S=(a,o)=>{F(o);const s={...c};switch(o){case 0:s.status="";break;case 1:s.status="open";break;case 2:s.status="in-progress";break;case 3:s.status="resolved";break;case 4:s.status="closed";break;case 5:s.assigned="unassigned";break;case 6:s.assigned="me";break}z(s)},m=a=>{P(`/admin/tickets/${a}`)},x=a=>{switch(a){case"open":return{bg:"#EEF7FF",color:"#1A73E8"};case"in-progress":return{bg:"#FFF7E0",color:"#F29D41"};case"resolved":return{bg:"#E7F7ED",color:"#34A853"};case"closed":return{bg:"#F2F2F2",color:"#5F6368"};default:return{bg:"#F2F2F2",color:"#5F6368"}}},A=a=>{switch(a){case"low":return{bg:"#E7F7ED",color:"#34A853"};case"medium":return{bg:"#FFF7E0",color:"#F29D41"};case"high":return{bg:"#FFEBEE",color:"#E53935"};case"urgent":return{bg:"#7F1D1D",color:"#FFFFFF"};default:return{bg:"#F2F2F2",color:"#5F6368"}}},R=a=>{if(!a)return"N/A";try{const o=new Date(a);return isNaN(o.getTime())?"Invalid Date":new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(o)}catch(o){return console.error("Date formatting error:",o),"Invalid Date"}},W=[{id:"ticketNumber",header:"Ticket #",accessorKey:"ticketNumber",cell:a=>{var o,s;return e.jsxs(v,{variant:"body2",sx:{fontWeight:"bold",color:(o=a.row.original.isRead)!=null&&o.byAdmin?"text.secondary":"primary.main",cursor:"pointer"},onClick:()=>m(a.row.original._id),children:["#",a.getValue(),!((s=a.row.original.isRead)!=null&&s.byAdmin)&&e.jsx(Te,{sx:{display:"inline-block",width:8,height:8,backgroundColor:"#FF3B30",borderRadius:"50%",ml:1}})]})}},{id:"subject",header:"Subject",accessorKey:"subject",cell:a=>e.jsx(v,{variant:"body2",sx:{maxWidth:250,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",cursor:"pointer"},onClick:()=>m(a.row.original._id),children:a.getValue()})},{id:"user",header:"Customer",accessorKey:"user",cell:a=>{const s=a.row.original._userData||{},h=s.firstName?s.firstName.charAt(0).toUpperCase():s.email?s.email.charAt(0).toUpperCase():"?";return e.jsxs(j,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(J,{src:s.profilePicture||"",sx:{width:24,height:24,mr:1},children:!s.profilePicture&&h}),e.jsxs(v,{variant:"body2",children:[a.getValue()," "]})]})}},{id:"category",header:"Category",accessorKey:"category",cell:a=>e.jsx(v,{variant:"body2",sx:{textTransform:"capitalize"},children:a.getValue()})},{id:"status",header:"Status",accessorKey:"status",cell:a=>{const o=typeof a.getValue()=="string"?a.getValue():"unknown",{bg:s,color:h}=x(o);return e.jsx(f,{label:o.replace("-"," "),sx:{backgroundColor:s,color:h,textTransform:"capitalize",fontWeight:"medium",fontSize:"0.75rem"},size:"small"})}},{id:"priority",header:"Priority",accessorKey:"priority",cell:a=>{const o=typeof a.getValue()=="string"?a.getValue():"unknown",{bg:s,color:h}=A(o);return e.jsx(f,{label:o,sx:{backgroundColor:s,color:h,textTransform:"capitalize",fontWeight:"medium",fontSize:"0.75rem"},size:"small"})}},{id:"assignedTo",header:"Assigned To",accessorKey:"assignedTo",cell:a=>{const s=a.row.original._assignedData;return s?e.jsxs(j,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(J,{src:s.profilePicture||"",sx:{width:24,height:24,mr:1},children:s.firstName?s.firstName.charAt(0):"?"}),e.jsxs(v,{variant:"body2",children:[a.getValue()," "]})]}):e.jsx(f,{label:"Unassigned",sx:{backgroundColor:"#F2F2F2",color:"#5F6368",fontSize:"0.75rem"},size:"small"})}},{id:"updatedAt",header:"Last Updated",accessorKey:"updatedAt",cell:a=>{const o=a.getValue();return e.jsx(v,{variant:"body2",children:o?R(o):"N/A"})}}];return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(v,{variant:"h4",fontWeight:"bold",color:"text.primary",children:"Ticket Management"}),e.jsx(v,{variant:"body1",color:"text.secondary",children:"Manage and respond to customer support tickets"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 mb-6",children:[e.jsx(y.Base,{stats:{value:l.total,label:"Total Tickets"}}),e.jsx(y.Success,{stats:{value:l.open,label:"Open Tickets"}}),e.jsx(y.Warning,{stats:{value:l.inProgress,label:"In Progress"}}),e.jsx(y.Wind,{stats:{value:l.resolved,label:"Resolved"}}),e.jsx(y.Outlined,{stats:{value:l.closed,label:"Closed"}}),e.jsx(y.Error,{stats:{value:l.unassigned,label:"Unassigned"}})]}),e.jsx(y.Base,{className:"mb-6",children:e.jsxs(fe,{value:b,onChange:S,variant:"scrollable",scrollButtons:"auto",sx:{"& .MuiTab-root":{minWidth:"auto",px:3,fontWeight:500},borderBottom:1,borderColor:"divider"},children:[e.jsx(C,{label:e.jsxs(j,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(me,{name:"ticket",size:18,sx:{mr:1}}),e.jsx("span",{children:"All Tickets"}),e.jsx(f,{label:l.total,size:"small",sx:{ml:1,height:20,fontSize:"0.75rem"}})]})}),e.jsx(C,{label:e.jsxs(j,{sx:{display:"flex",alignItems:"center"},children:[e.jsx("span",{children:"Open"}),e.jsx(f,{label:l.open,size:"small",sx:{ml:1,height:20,fontSize:"0.75rem"}})]})}),e.jsx(C,{label:e.jsxs(j,{sx:{display:"flex",alignItems:"center"},children:[e.jsx("span",{children:"In Progress"}),e.jsx(f,{label:l.inProgress,size:"small",sx:{ml:1,height:20,fontSize:"0.75rem"}})]})}),e.jsx(C,{label:e.jsxs(j,{sx:{display:"flex",alignItems:"center"},children:[e.jsx("span",{children:"Resolved"}),e.jsx(f,{label:l.resolved,size:"small",sx:{ml:1,height:20,fontSize:"0.75rem"}})]})}),e.jsx(C,{label:e.jsxs(j,{sx:{display:"flex",alignItems:"center"},children:[e.jsx("span",{children:"Closed"}),e.jsx(f,{label:l.closed,size:"small",sx:{ml:1,height:20,fontSize:"0.75rem"}})]})}),e.jsx(C,{label:e.jsxs(j,{sx:{display:"flex",alignItems:"center"},children:[e.jsx("span",{children:"Unassigned"}),e.jsx(f,{label:l.unassigned,size:"small",sx:{ml:1,height:20,fontSize:"0.75rem"}})]})}),e.jsx(C,{label:"My Tickets"})]})}),e.jsx(y.Base,{children:e.jsx(he,{columns:W,data:t,loading:n,pagination:!0,initialState:{pagination:{pageSize:10},sorting:[{id:"updatedAt",desc:!0}]}})})]})};export{Ee as default};
